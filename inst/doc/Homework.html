<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Deyu He" />

<meta name="date" content="2023-11-28" />

<title>Homework</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Homework</h1>
<h4 class="author">Deyu He</h4>
<h4 class="date">2023-11-28</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(bootstrap)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(R2OpenBUGS)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(DAAG)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span></code></pre></div>
<div id="question" class="section level2">
<h2>Question</h2>
<p>Use your knowledge to write three or more examples, including figures
or tables, or better yet, mathematical formulas.</p>
</div>
<div id="answer" class="section level2">
<h2>Answer</h2>
<p>example 1:</p>
<p>The first example describes the ratio of men to women in my master’s
class</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(plotrix)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#Number of male and female students in the master&#39;s class</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">13</span>,<span class="dv">32</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#Enter labels</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>ns <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;women&quot;</span>,<span class="st">&quot;men&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#Enter colors</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>cs <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;lightgray&quot;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#Draw a 3D pie chart</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="fu">pie3D</span>(x,<span class="at">labels =</span> ns,<span class="at">explode =</span> <span class="fl">0.1</span>,<span class="at">col =</span> cs,<span class="at">main =</span> <span class="st">&quot;examples 1.1&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#Draw a flat pie chart</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="fu">pie</span>(x,<span class="at">labels =</span> ns,<span class="at">col =</span> cs,<span class="at">main =</span> <span class="st">&quot;examples 1.2&quot;</span>)</span></code></pre></div>
<p>example 2:</p>
<p>Plot a table of coefficients of the regression equation for y =
x^3</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>lmr <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>co <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmr)<span class="sc">$</span>coefficients</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="fu">expression</span>(y <span class="sc">==</span> x<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>result <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(co,<span class="at">digits =</span> <span class="dv">2</span>,<span class="at">align =</span> <span class="st">&#39;c&#39;</span>,<span class="at">caption =</span> title)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="fu">plot</span>(x,y,<span class="at">caption =</span> <span class="st">&quot;title&quot;</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">abline</span>(lmr,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>result</span></code></pre></div>
<p>example 3:</p>
<p>Map the distribution of experience.Data is arbitrary data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">22</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">55</span>,<span class="dv">56</span>,<span class="dv">80</span>,<span class="dv">94</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>fun_table <span class="ot">&lt;-</span> <span class="cf">function</span>(x){x <span class="ot">&lt;-</span> <span class="fu">sort</span>(x) </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(x) </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">c</span>(<span class="fu">table</span>(x)))</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>pct <span class="ot">=</span> tab <span class="sc">/</span> n </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(x)),<span class="at">freq =</span> tab,<span class="at">pct =</span> pct,<span class="at">cumfreq =</span> <span class="fu">cumsum</span>(tab),<span class="at">cumpct =</span> <span class="fu">cumsum</span>(pct)) </span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>}</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">fun_table</span>(dat),<span class="at">align =</span> <span class="st">&#39;c&#39;</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dat)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>datafre <span class="ot">&lt;-</span> <span class="fu">fun_table</span>(d<span class="sc">$</span>dat)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>pic <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> datafre,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>dat,<span class="at">y=</span>cumpct))</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>pic <span class="sc">+</span><span class="fu">stat_ecdf</span>(<span class="at">geom =</span> <span class="st">&quot;step&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="fu">scale_y_continuous</span>( </span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">01</span>, <span class="fl">1.01</span>), </span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="at">name =</span> <span class="st">&quot; cumulative percent&quot;</span>) </span></code></pre></div>
</div>
<div id="question-1" class="section level2">
<h2>Question</h2>
<p>Inverse transformation method is used to reproduce some parameter
functions of the Sample function</p>
</div>
<div id="answer-1" class="section level2">
<h2>Answer</h2>
<p>In this chunk,reproduce the function of argument “replace” in
sample.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#Take the same parameters as the sample function</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>newsample <span class="ot">&lt;-</span> <span class="cf">function</span>(x,size,<span class="at">replace =</span> <span class="cn">FALSE</span>,<span class="at">prob =</span> <span class="cn">NULL</span>){</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="cf">if</span> (replace <span class="sc">==</span> <span class="cn">TRUE</span>){         <span class="co">#sample with replacement</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    A <span class="ot">&lt;-</span> <span class="fu">runif</span>(size,<span class="dv">1</span>,<span class="fu">length</span>(x))<span class="co">#sampling from uniform distribution</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    B <span class="ot">&lt;-</span> <span class="fu">round</span>(A)               <span class="co">#round random numbers to  indexs</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    y <span class="ot">&lt;-</span> x[B]</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  }</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (size <span class="sc">&lt;=</span> <span class="fu">length</span>(x) <span class="sc">&amp;</span> replace <span class="sc">==</span> <span class="cn">FALSE</span>){  <span class="co">#sample without replacement </span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    n <span class="ot">&lt;-</span> size;</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="dv">0</span>;                     <span class="co">#sampled numbers</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>size);             <span class="co">#The while loop replaces elements in y with elements in x</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    Results <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>size</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    <span class="cf">while</span> (k<span class="sc">&lt;</span>n){</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>      D <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fu">length</span>(x))</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>      E <span class="ot">&lt;-</span> <span class="fu">round</span>(D)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>      <span class="co">#removes the taken element from x</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>      <span class="cf">if</span> (E <span class="sc">%in%</span> Results){</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>        k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>        Results <span class="ot">&lt;-</span> Results[<span class="sc">-</span><span class="fu">which</span>(Results<span class="sc">==</span>E)]</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>        y[k] <span class="ot">&lt;-</span> x[E] </span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>      }</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>    }</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  }</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  <span class="cf">else</span> {              <span class="co">#Except for the above two methods, the rest will report errors</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="st">&quot;input error&quot;</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>  }</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>}</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#Compare the two functions sample and newsample</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="fu">newsample</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>),<span class="dv">5</span>) <span class="co">#Sampling without replacement</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="fu">newsample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co">#Sampling with replacement</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>),<span class="dv">5</span>)</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="at">replace=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="question-2" class="section level2">
<h2>Question</h2>
<p>Use the inverse transform method to generate a random sample of size
1000 from Laplace distribution.Compare the generated sample to the
distribution</p>
</div>
<div id="answer-2" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">vector</span>()   <span class="co">#generate numbers</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#Divide the generated u into two situations</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="cf">while</span> (k<span class="sc">&lt;</span>n){</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>   k <span class="ot">&lt;-</span> k<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>   <span class="cf">if</span> (<span class="dv">0</span><span class="sc">&lt;</span>u[k] <span class="sc">&amp;</span> u[k]<span class="sc">&lt;=</span><span class="fl">0.5</span>){</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>     result[k] <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">2</span><span class="sc">*</span>u[k]) </span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>   }</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>   <span class="cf">else</span> {</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>     result[k] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>u[k]))</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>   }</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>}</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="fu">hist</span>(result,<span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="fl">0.1</span>)</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">abs</span>(y))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="fu">lines</span>(y,z)</span></code></pre></div>
</div>
<div id="question-3" class="section level2">
<h2>Question</h2>
<p>Write a function to generate a random sample of size n from the
Beta(a, b) distribution by the acceptance-rejection method. Generate a
random sample of size 1000 from the Beta(3,2) distribution. Graph the
histogram of the sample with the theoretical Beta(3,2) density
superimposed.</p>
</div>
<div id="answer-3" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># creat the function</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>betasample <span class="ot">&lt;-</span> <span class="cf">function</span>(n,a,b){</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  samplenum <span class="ot">&lt;-</span> n  </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="cf">while</span> (k <span class="sc">&lt;</span> samplenum){</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="co">#define U</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="co">#define g(x)</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="cf">if</span> (x<span class="sc">^</span>(a<span class="dv">-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x)<span class="sc">^</span>(b<span class="dv">-1</span>) <span class="sc">&gt;</span> u){ <span class="co">#define c = gamma(a+b)/(gamma(a)+gamma(b))</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>      result[k] <span class="ot">&lt;-</span> x</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    }</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  }</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>}</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#generate 1000 samples from the Beta distribution and draw the histogram with theoretical Beta(3,2) density</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">betasample</span>(n,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="fu">hist</span>(data,<span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dbeta</span>(x,<span class="dv">3</span>,<span class="dv">2</span>),<span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="question-4" class="section level2">
<h2>Question</h2>
<p>Write a function to generate random variates from
f=3*(1-x^2)/4,|x|&lt;=1, and construct the histogram density estimate of
a large simulated random sample</p>
</div>
<div id="answer-4" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>Ekernel <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  u1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(n,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  u2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(n,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  u3 <span class="ot">&lt;-</span> <span class="fu">runif</span>(n,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="cf">while</span> (k <span class="sc">&lt;</span> n){</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(u3[k])<span class="sc">&gt;=</span><span class="fu">abs</span>(u2[k]) <span class="sc">&amp;</span> <span class="fu">abs</span>(u3[k])<span class="sc">&gt;=</span><span class="fu">abs</span>(u1[k])){</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>      result[k] <span class="ot">&lt;-</span> u2[k]</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>      </span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    }</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>      result[k] <span class="ot">&lt;-</span> u3[k]</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>    }</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  }</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>}</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">Ekernel</span>(<span class="dv">1000</span>)</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="fu">hist</span>(x,<span class="at">prob =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="question-5" class="section level2">
<h2>Question</h2>
<p>Prove that the algorithm given in Exercise 3.9 generates variates
from the density f=3*(1-x^2)/4,|x|&lt;=1.</p>
</div>
<div id="answer-5" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="sc">!</span>[Homework ](<span class="dv">3</span>.<span class="fl">10.</span>jpg)</span></code></pre></div>
</div>
<div id="question-6" class="section level2">
<h2>Question</h2>
<p>Proof that what value <span class="math inline">\(ρ
=\frac{c}{d}\)</span> should take to minimize the asymptotic variance of
<span class="math inline">\(\hat{π}\)</span>?</p>
</div>
<div id="answer-6" class="section level2">
<h2>Answer</h2>
<p>when <span class="math inline">\(0 ≤ ρ ≤ 1\)</span>, <span class="math inline">\(p = \frac{2l}{{\pi}d}\)</span> <span class="math inline">\(\hat{p} = \frac{m}{n} =
\frac{2l}{\hat{\pi}d}\)</span> <span class="math inline">\(\hat{p} =
2\frac{ln}{dm}\)</span> because of <span class="math inline">\(m \sim
B(n,p)\)</span> <span class="math display">\[\sqrt{n}(\hat{p}-\frac{2\rho}{\pi})
\xrightarrow{L}N(0,\frac{p(1-p)}{n}) \]</span> use <span class="math inline">\(\Delta\)</span> method, <span class="math display">\[\sqrt{n}(\frac{1}{\hat{p}}-\frac{\pi}{2\rho})
\xrightarrow{L}N(0,\frac{{\pi}^2({\pi}-2p)}{8n\rho^3}) \]</span> so the
asymptotical variance of the <span class="math inline">\(\hat{\pi}\)</span> is <span class="math inline">\(D(\rho) = \frac{1}{2}
\frac{\pi^2}{n}(\frac{\pi}{\rho}-2)\)</span> <span class="math inline">\(D&#39;(\rho) = -\frac{\pi^3}{2n\rho^2} &lt;
0\)</span> Hence, when <span class="math inline">\(\rho = 1\)</span>,the
asymptotical variance of the <span class="math inline">\(\hat{\pi}\)</span> is smallest.</p>
</div>
<div id="question-7" class="section level2">
<h2>Question</h2>
<p>Take three different values of <span class="math inline">\(ρ\)</span>
(<span class="math inline">\(0 ≤ ρ ≤ 1\)</span>, including <span class="math inline">\(ρ_{min}\)</span>) and use Monte Carlo simulation
to verify.</p>
</div>
<div id="answer-7" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>niddle.var <span class="ot">&lt;-</span> <span class="cf">function</span>(l){</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fl">1e6</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">runif</span>(m,<span class="dv">0</span>,d<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">runif</span>(m,<span class="dv">0</span>,pi<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  pihat <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> l <span class="sc">/</span> d  <span class="sc">/</span><span class="fu">mean</span>(l<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="fu">sin</span>(y)<span class="sc">&gt;</span>x)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  pihat</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>}</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>values.min <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>values1 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>values2 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>  values.min[i] <span class="ot">&lt;-</span> <span class="fu">niddle.var</span>(<span class="dv">1</span>)</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>  values1[i] <span class="ot">&lt;-</span> <span class="fu">niddle.var</span>(<span class="fl">0.5</span>)</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  values2[i] <span class="ot">&lt;-</span> <span class="fu">niddle.var</span>(<span class="fl">0.8</span>)</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>}</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">var</span>(values.min),<span class="fu">var</span>(values1),<span class="fu">var</span>(values2)),<span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;0.5&quot;</span>,<span class="st">&quot;0.8&quot;</span>)</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="fu">rownames</span>(data) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;var&quot;</span>)</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="fu">as.table</span>(data)</span></code></pre></div>
</div>
<div id="question-8" class="section level2">
<h2>Question</h2>
<p>Compute <span class="math inline">\(Cov(e^U,e^{1-U})\)</span> and
<span class="math inline">\(Var(e^U + e^{1−U})\)</span>, where <span class="math inline">\(U\sim Uniform(0,1)\)</span>. What is the percent
reduction in variance of <span class="math inline">\(\hat{θ}\)</span>
that can be achieved using antithetic variates(compared with simple
MC)?</p>
</div>
<div id="answer-8" class="section level2">
<h2>Answer</h2>
<p>When <span class="math inline">\(U\sim Uniform(0,1)\)</span> <span class="math inline">\(Cov(e^U,e^{1-U})\\\)</span> <span class="math inline">\(=E(e^U e^{1-U})-E(e^U)E(e^{1-U})\\\)</span> <span class="math inline">\(=e-(e-1)^2\)</span> <span class="math inline">\(Var(e^U + e^{1−U})\)</span> <span class="math inline">\(=Var(e^U)+Var(e^{1-U})+2Cov(e^U,e^{1-U})\)</span>
<span class="math inline">\(=e^2-1+2*(e-(e-1)^2)\)</span> <span class="math inline">\(=10e-5-3e^2\)</span></p>
<p>(1)Simple MC <span class="math inline">\(X_1,···,X_m \sim
U(0,1)\)</span> <span class="math display">\[\overline{g(X)} =
\frac{1}{m}\sum_{i=1}^m g(X_i)\]</span> <span class="math display">\[Var(\widehat{\theta})=\frac{Var(g(X_i))}{m}=\frac{e^2-1}{2m}\]</span></p>
<p>(2)Antithetic variates</p>
<p><span class="math display">\[\widehat{\theta}=\frac{2}{m}\sum_{j=1}^{\frac{m}{2}}(e^{U_j}+e^{(1-U_j)})\]</span>
<span class="math display">\[Var(\widehat{\theta})=\frac{2*(10e-5-3e^2)}{m}\]</span>
the percent reduction in variance of <span class="math inline">\(\widehat{\theta}\)</span> <span class="math display">\[100\frac{\frac{e^2-1}{2m}-\frac{2*(10e-5-3e^2)}{m}}{\frac{e^2-1}{2m}}\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co">#the result is</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="dv">1-4</span><span class="sc">*</span>(<span class="dv">10</span><span class="sc">*</span><span class="fu">exp</span>(<span class="dv">1</span>)<span class="sc">-</span><span class="dv">5-3</span><span class="sc">*</span><span class="fu">exp</span>(<span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">exp</span>(<span class="dv">2</span>)<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="question-9" class="section level2">
<h2>Question</h2>
<p>Refer to Exercise 5.6. Use a Monte Carlo simulation to estimate <span class="math inline">\(\theta\)</span> by the antithetic variate approach
and by the simple Monte Carlo method. Compute an empirical estimate of
the percent reduction in variance using the antithetic variate. Compare
the result with the theoretical value from Exercise 5.6.</p>
</div>
<div id="answer-9" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co">#simple mC</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>MC.SIMPLE <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  theta.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">exp</span>(x))</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  theta.hat</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>}</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#Antithetic Variables</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>MC.ANTI <span class="ot">&lt;-</span> <span class="cf">function</span>(m){</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(m<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>u</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>  rvalues <span class="ot">&lt;-</span> (<span class="fu">exp</span>(u) <span class="sc">+</span> <span class="fu">exp</span>(<span class="dv">1</span><span class="sc">-</span>u))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  theta.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(rvalues) </span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>  theta.hat</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>}</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#compute the variance reduction</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>MC1 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>MC2 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m){</span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>  MC1[i] <span class="ot">&lt;-</span> <span class="fu">MC.SIMPLE</span>(<span class="dv">1000</span>)</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>  MC2[i] <span class="ot">&lt;-</span> <span class="fu">MC.ANTI</span>(<span class="dv">1000</span>)</span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>}</span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="fu">print</span>((<span class="fu">var</span>(MC1)<span class="sc">-</span><span class="fu">var</span>(MC2))<span class="sc">/</span><span class="fu">var</span>(MC1))</span></code></pre></div>
</div>
<div id="question-1-1" class="section level2">
<h2>Question 1</h2>
<p>Stratified Sampling:<span class="math inline">\(Var(\hat{\theta}^M)=\frac{1}{Mk}\Sigma_{i=1}^{k}\sigma_i^2
+\frac{Var(\theta_I)}{M}\)</span>, where <span class="math inline">\(\theta_i =
E[g(U)|I=i],\sigma_i^2=Var[g(U)|I=i]\)</span> and <span class="math inline">\(I\)</span> takes uniform distribution over <span class="math inline">\({1,...,k}\)</span>. Proof that if g is a
continuous function over (a,b),then <span class="math inline">\(\frac{Var(\hat{\theta}^S)}{Var(\hat{\theta}^M)}\xrightarrow{}0\)</span>
as <span class="math inline">\(b_i - a_i \xrightarrow{}0\)</span> for
all <span class="math inline">\(i=1,...,k.\)</span></p>
<p>##Answer</p>
<p>Since <span class="math inline">\(Var(\hat{\theta}^M)=\frac{1}{Mk}\Sigma_{i=1}^{k}\sigma_i^2
+\frac{Var(\theta_I)}{M}\)</span>,we have <span class="math display">\[\frac{Var(\hat{\theta}^M)}{Var(\hat{\theta}^S)} =
1 + \frac{Var(\theta_I)}{MVar(\hat{\theta}^S)}\]</span> When <span class="math inline">\(I\)</span> takes uniform distribution over <span class="math inline">\({1,...,k}\)</span>,<span class="math inline">\(Var(\hat{\theta}^S)=\frac{1}{Mk}\Sigma_{i=1}^{k}\sigma_i^2\)</span>,
<span class="math display">\[\begin{aligned}
\frac{Var(\hat{\theta}_I)}{MVar(\hat{\theta}^S)} &amp;=
\frac{E(\theta_I^2)-(E\theta_I)^2}{\Sigma_{i=1}^{k}\sigma_i^2}\\
&amp;=
\frac{\Sigma_{i=1}^{k}\theta_i^2-\frac{(\Sigma_{i=1}^{k}\theta_i)^2}{k}}{\Sigma_{i=1}^{k}\sigma_i^2}
\\
&amp;=
\frac{\Sigma_{i=1}^{k}[\frac{\int_{a_i}^{b_i}g(x)dx}{b_i-a_i}]^2-\frac{1}{k}[\Sigma_{i=1}^{k}\frac{\int_{a_i}^{b_i}g(x)dx}{b_i-a_i}]^2}{\Sigma_{i=1}^{k}\frac{\int_{a_i}^{b_i}g(x)^2dx}{b_i-a_i}-\Sigma_{i=1}^{k}[\frac{\int_{a_i}^{b_i}g(x)dx}{b_i-a_i}]^2}
\\
&amp;=O(k)
\end{aligned}\]</span> as <span class="math inline">\(b_i - a_i
\xrightarrow{}0\)</span> for all <span class="math inline">\(i=1,...,k\)</span>,we know that <span class="math inline">\(k\xrightarrow{}\infty\)</span> Hence,<span class="math inline">\(\frac{Var(\hat{\theta}^S)}{Var(\hat{\theta}^M)}
\xrightarrow{}0\)</span></p>
</div>
<div id="question-5.13" class="section level2">
<h2>Question 5.13</h2>
<p>Find two importance functions <span class="math inline">\(f_1\)</span> and <span class="math inline">\(f_2\)</span> and explain which of the two
importance functions should produce the smaller variance in estimating
<span class="math display">\[\int_1^{\infty}\frac{x^2}{\sqrt{2\pi}}e^{-x^2/2}dx\]</span></p>
</div>
<div id="answer-10" class="section level2">
<h2>Answer</h2>
<p>The chosen functions <span class="math inline">\(f_1\)</span> and
<span class="math inline">\(f_2\)</span> are: <span class="math display">\[f_1(x)=\frac{1}{2}e^{-\frac{x}{2}},x&gt;0\]</span>
<span class="math display">\[f_2(x)=\frac{1}{16}x^2e^{-\frac{x}{2}}\sim{}Ga(3,\frac{1}{2}),x&gt;0\]</span>
Firstly,we use</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> se <span class="ot">&lt;-</span><span class="fu">numeric</span>(<span class="dv">2</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  (x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi))<span class="sc">*</span>(x<span class="sc">&gt;</span><span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>}</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>f1 <span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>}</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>f2 <span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  (x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">16</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>}</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rexp</span>(m,<span class="fl">0.5</span>)  <span class="co">#using f1</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(m,<span class="at">shape =</span> <span class="dv">3</span>,<span class="at">rate =</span> <span class="fl">0.5</span>)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#By the graphs,we compare the f1 with f2.</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="at">length =</span> <span class="dv">1000</span>)</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="fu">plot</span>(x1,<span class="fu">g</span>(x1),<span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="fu">lines</span>(x1,<span class="fu">f1</span>(x1),<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="fu">lines</span>(x1,<span class="fu">f2</span>(x1),<span class="at">col =</span> <span class="st">&quot;yellow&quot;</span>)</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#the variance of f1 and f2</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>gf1 <span class="ot">&lt;-</span> <span class="fu">g</span>(x)<span class="sc">/</span><span class="fu">f1</span>(x)</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>gf2 <span class="ot">&lt;-</span> <span class="fu">g</span>(y)<span class="sc">/</span><span class="fu">f2</span>(y)</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>theta.hat[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gf1)</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>se[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sd</span>(gf1)</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>theta.hat[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gf2)</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>se[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sd</span>(gf2)</span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="fu">rbind</span>(theta.hat,se)</span></code></pre></div>
<p>we can know that <span class="math inline">\(f_1\)</span> is closer
to g(x) than <span class="math inline">\(f_2\)</span>,and the variance
of the importance function <span class="math inline">\(f_1\)</span> is
smaller than <span class="math inline">\(f_2\)</span></p>
</div>
<div id="question-5.14" class="section level2">
<h2>Question 5.14</h2>
<p>Obtain a Monte Carlo estimate of <span class="math display">\[\int_1^{\infty}\frac{x^2}{\sqrt{2\pi}}e^{-x^2/2}dx\]</span>
by importance sampling.</p>
</div>
<div id="answer-11" class="section level2">
<h2>Answer</h2>
<p>From 5.13,we can see <span class="math inline">\(f_1\)</span> is a
better choice.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  (x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi))<span class="sc">*</span>(x<span class="sc">&gt;</span><span class="dv">1</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>}</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>f1 <span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>}</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rexp</span>(m,<span class="fl">0.5</span>)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>gf <span class="ot">&lt;-</span> <span class="fu">g</span>(x)<span class="sc">/</span><span class="fu">f1</span>(x)</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(gf)</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>theta.hat  <span class="co">#estimator</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="fu">integrate</span>(g,<span class="dv">1</span>,<span class="cn">Inf</span>) <span class="co">#real values</span></span></code></pre></div>
<p>The estimator is almostly equal to the real number.</p>
</div>
<div id="question-5.15" class="section level2">
<h2>Question 5.15</h2>
<p>Obtain the stratified importance sampling estimate in Example 5.13
and compare it with the result of Example 5.10.</p>
</div>
<div id="answer-12" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span>    <span class="co">#stratified numbers</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>estimate <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k) <span class="co">#estimates</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>variance <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k) </span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span>x <span class="sc">-</span> <span class="fu">log</span>(<span class="dv">1</span><span class="sc">+</span>x<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (x<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">*</span> (x<span class="sc">&lt;</span><span class="dv">1</span>)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>}</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span>x)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">*</span> (x<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">*</span> (x<span class="sc">&lt;</span><span class="dv">1</span>)</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>}</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">runif</span>(M<span class="sc">/</span>k,(i<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">5</span>,i<span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">g</span>(x)<span class="sc">/</span><span class="fu">f</span>(x)</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>  variance[i] <span class="ot">&lt;-</span> <span class="fu">var</span>(rate)</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>  estimate[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rate)</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>}</span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(estimate)</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">sum</span>(variance)<span class="sc">/</span>(M<span class="sc">/</span>k)</span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>theta.hat</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>sd</span></code></pre></div>
<p>Compare with Example 5.10 <span class="math inline">\(\hat{\theta}=0.5257801,sd = 0.0970314\)</span> the
variance of the result is far less than exmple 5.10</p>
</div>
<div id="question-6.5" class="section level2">
<h2>Question 6.5</h2>
<p>Use a Monte Carlo experiment to estimate the coverage probability of
the t-interval for random samples of <span class="math inline">\(\chi^2{(2)}\)</span> data with sample size
n=20.Compare your t-interval results with the simulation results in
Example 6.4.</p>
</div>
<div id="answer-13" class="section level2">
<h2>Answer</h2>
<p>As we konw ,<span class="math inline">\(X_1,...X_n\)</span> iid
copies of <span class="math inline">\(\chi^2(2)\)</span>,<span class="math inline">\(EX=2\)</span></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co"># 6.5 confidence interval</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>calci <span class="ot">&lt;-</span> <span class="cf">function</span>(n,alpha){</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  confidence.int <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">2</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(n,<span class="at">df =</span> <span class="dv">2</span>)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  theta.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">var</span>(x)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>  UCL <span class="ot">&lt;-</span> theta.hat <span class="sc">+</span> <span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>,<span class="at">df =</span> n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">sqrt</span>(d<span class="sc">/</span>n) <span class="co">#upper confidence limit</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>  LCL <span class="ot">&lt;-</span> theta.hat <span class="sc">-</span> <span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>,<span class="at">df =</span> n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">sqrt</span>(d<span class="sc">/</span>n) <span class="co">#lower confidence limit</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>  confidence.int[<span class="dv">1</span>] <span class="ot">&lt;-</span> LCL</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>  confidence.int[<span class="dv">2</span>] <span class="ot">&lt;-</span> UCL</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>  <span class="fu">return</span>(confidence.int)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>}</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>  cfint <span class="ot">&lt;-</span> <span class="fu">calci</span>(n,alpha)</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>  <span class="cf">if</span> (cfint[<span class="dv">1</span>]<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> cfint[<span class="dv">2</span>]<span class="sc">&gt;</span><span class="dv">2</span>){</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>    counts[i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>  }</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>}</span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="co"># Example 6.4</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">replicate</span>(k,<span class="at">expr =</span> {</span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="at">mean =</span> <span class="dv">0</span>,<span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>  (n<span class="dv">-1</span>) <span class="sc">*</span> <span class="fu">var</span>(x)<span class="sc">/</span><span class="fu">qchisq</span>(alpha,<span class="at">df =</span> n<span class="dv">-1</span>)</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>})</span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a><span class="fu">mean</span>(counts)</span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a><span class="fu">mean</span>(results <span class="sc">&gt;</span> <span class="dv">4</span>)</span></code></pre></div>
</div>
<div id="question-6.a" class="section level2">
<h2>Question 6.A</h2>
<p>Use Monte Carlo simulation to investigate whether the empirical Type
I error rate of the t-test is approximately equal to the nominal
significance level <span class="math inline">\(\alpha\)</span> ,when the
sampled population is non-normal. Discuss the simulation results for the
cases where the sampled population is (i)<span class="math inline">\(\chi^2(x)\)</span> (ii)<span class="math inline">\(Uniform(0,2)\)</span> (iii)<span class="math inline">\(Exponential(rate = 1\)</span>)</p>
</div>
<div id="answer-14" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> mu2 <span class="ot">&lt;-</span> mu3 <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>p1<span class="ot">&lt;-</span> p2 <span class="ot">&lt;-</span> p3 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m){</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(n,<span class="at">df =</span> <span class="dv">1</span>)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(n,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  x3 <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n,<span class="dv">1</span>)</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  x1test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x1,<span class="at">alternative =</span> <span class="st">&quot;greater&quot;</span>,<span class="at">mu =</span> mu1) <span class="co">#(i)chi-square</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>  x2test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x2,<span class="at">alternative =</span> <span class="st">&quot;greater&quot;</span>,<span class="at">mu =</span> mu2) <span class="co">#Uniform(0,2)</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>  x3test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x3,<span class="at">alternative =</span> <span class="st">&quot;greater&quot;</span>,<span class="at">mu =</span> mu3) <span class="co">#exp(1)</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>  p1[i] <span class="ot">&lt;-</span> x1test<span class="sc">$</span>p.value</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>  p2[i] <span class="ot">&lt;-</span> x2test<span class="sc">$</span>p.value</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>  p3[i] <span class="ot">&lt;-</span> x3test<span class="sc">$</span>p.value</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>}</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>p1.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(p1 <span class="sc">&lt;</span> alpha)</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>se1.hat<span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p1.hat <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p1.hat) <span class="sc">/</span> m)</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>p2.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(p2 <span class="sc">&lt;</span> alpha)</span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>se2.hat<span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p2.hat <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p2.hat) <span class="sc">/</span> m)</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>p3.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(p3 <span class="sc">&lt;</span> alpha)</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>se3.hat<span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p3.hat <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p3.hat) <span class="sc">/</span> m)</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(p1.hat,se1.hat))</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(p2.hat,se2.hat))</span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(p3.hat,se3.hat))</span></code></pre></div>
<p>Hence,we can see the <span class="math inline">\(\chi^2(x)\)</span>
is more significant than other two random variables.</p>
</div>
<div id="question-10" class="section level2">
<h2>Question</h2>
<p>Considering <span class="math inline">\(m=1000\)</span> hypotheses,
under the null hypothesis, the <span class="math inline">\(p\sim{}U(0,1)\)</span>, and under the opposing
hypothesis, the <span class="math inline">\(p\sim{}beta(0.1,1)\)</span>.Bonferroni correction
and BH correction are applied to the generated P-values, and the
comparison with <span class="math inline">\(\alpha = 0.1\)</span>
determines whether the null hypothesis is rejected.</p>
</div>
<div id="answer-15" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co">#generate p-value</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>fwer1 <span class="ot">&lt;-</span> fdr1 <span class="ot">&lt;-</span> tpr1 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>fwer2 <span class="ot">&lt;-</span> fdr2 <span class="ot">&lt;-</span> tpr2 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>orignalp <span class="ot">&lt;-</span> <span class="cf">function</span>(m){</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  p0 <span class="ot">&lt;-</span> <span class="fu">runif</span>(m<span class="sc">*</span><span class="fl">0.95</span>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(m<span class="sc">*</span><span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="dv">1</span>)</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(p0,p1))</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>}</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#compute FWER</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>fwer <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha,x){</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">length</span>(x)){</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>    <span class="cf">if</span> (x[i]<span class="sc">&lt;</span>alpha){</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>    }</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>  } </span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">-</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="fu">length</span>(x))<span class="sc">^</span>(<span class="fu">length</span>(x)<span class="sc">-</span>k)</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>}</span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="co">#compute FDR</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>fdr <span class="ot">&lt;-</span> <span class="cf">function</span>(origvalues,adjust.val){</span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>  FN <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(origvalues)){</span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>    <span class="cf">if</span> (origvalues[i] <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">&amp;</span> adjust.val[i] <span class="sc">&gt;</span> <span class="fl">0.1</span>){</span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> FN <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a>    }</span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a>  }</span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a>  FN <span class="sc">/</span> <span class="fu">sum</span>(adjust.val <span class="sc">&gt;</span> <span class="fl">0.1</span>)</span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a>}</span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a><span class="co">#compute TPR</span></span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a>tpr <span class="ot">&lt;-</span> <span class="cf">function</span>(origvalues,adjust.val){</span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a>  TP <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">length</span>(origvalues)){</span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a>    <span class="cf">if</span> (origvalues[i] <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">&amp;</span> adjust.val[i] <span class="sc">&lt;</span> <span class="fl">0.1</span>){</span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> TP <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a>    }</span>
<span id="cb18-38"><a href="#cb18-38" tabindex="-1"></a>  }</span>
<span id="cb18-39"><a href="#cb18-39" tabindex="-1"></a>  TP <span class="sc">/</span> <span class="fu">sum</span>(origvalues <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb18-40"><a href="#cb18-40" tabindex="-1"></a>}</span>
<span id="cb18-41"><a href="#cb18-41" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m){</span>
<span id="cb18-42"><a href="#cb18-42" tabindex="-1"></a>  pvalues <span class="ot">&lt;-</span> <span class="fu">orignalp</span>(<span class="dv">1000</span>)</span>
<span id="cb18-43"><a href="#cb18-43" tabindex="-1"></a>  <span class="co">#generate adjust-pvalues</span></span>
<span id="cb18-44"><a href="#cb18-44" tabindex="-1"></a>  sortpvalues <span class="ot">&lt;-</span> <span class="fu">sort</span>(pvalues)</span>
<span id="cb18-45"><a href="#cb18-45" tabindex="-1"></a>  bonvalues <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(pvalues,<span class="at">method =</span> <span class="st">&quot;bonferroni&quot;</span>)</span>
<span id="cb18-46"><a href="#cb18-46" tabindex="-1"></a>  bhvalues <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(sortpvalues,<span class="at">method =</span> <span class="st">&quot;BH&quot;</span>)</span>
<span id="cb18-47"><a href="#cb18-47" tabindex="-1"></a>  fwer1[i] <span class="ot">&lt;-</span> <span class="fu">fwer</span>(alpha,bonvalues)</span>
<span id="cb18-48"><a href="#cb18-48" tabindex="-1"></a>  fwer2[i] <span class="ot">&lt;-</span> <span class="fu">fwer</span>(alpha,bhvalues)</span>
<span id="cb18-49"><a href="#cb18-49" tabindex="-1"></a>  fdr1[i] <span class="ot">&lt;-</span> <span class="fu">fdr</span>(pvalues,bonvalues)</span>
<span id="cb18-50"><a href="#cb18-50" tabindex="-1"></a>  fdr2[i] <span class="ot">&lt;-</span> <span class="fu">fdr</span>(sortpvalues,bhvalues)</span>
<span id="cb18-51"><a href="#cb18-51" tabindex="-1"></a>  tpr1[i] <span class="ot">&lt;-</span> <span class="fu">tpr</span>(pvalues,bonvalues)</span>
<span id="cb18-52"><a href="#cb18-52" tabindex="-1"></a>  tpr2[i] <span class="ot">&lt;-</span> <span class="fu">tpr</span>(sortpvalues,bhvalues)</span>
<span id="cb18-53"><a href="#cb18-53" tabindex="-1"></a>}</span>
<span id="cb18-54"><a href="#cb18-54" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-55"><a href="#cb18-55" tabindex="-1"></a>  <span class="at">FWER =</span> <span class="fu">c</span>(<span class="fu">mean</span>(fwer1),<span class="fu">mean</span>(fwer2)),</span>
<span id="cb18-56"><a href="#cb18-56" tabindex="-1"></a>  <span class="at">FDR =</span> <span class="fu">c</span>(<span class="fu">mean</span>(fdr1),<span class="fu">mean</span>(fdr2)),</span>
<span id="cb18-57"><a href="#cb18-57" tabindex="-1"></a>  <span class="at">TPR =</span> <span class="fu">c</span>(<span class="fu">mean</span>(tpr1),<span class="fu">mean</span>(tpr2)),</span>
<span id="cb18-58"><a href="#cb18-58" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="fu">c</span>(<span class="st">&quot;Bonferroni&quot;</span>,<span class="st">&quot;B-H&quot;</span>),</span>
<span id="cb18-59"><a href="#cb18-59" tabindex="-1"></a>  <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span></span>
<span id="cb18-60"><a href="#cb18-60" tabindex="-1"></a>)</span>
<span id="cb18-61"><a href="#cb18-61" tabindex="-1"></a><span class="fu">print</span>(df)</span></code></pre></div>
</div>
<div id="question-11" class="section level2">
<h2>Question</h2>
<p>Suppose the population has the exponential distribution with rate
<span class="math inline">\(\lambda\)</span>,then the MLE of <span class="math inline">\(\hat\lambda\)</span> is <span class="math inline">\(\hat\lambda = \frac{1}{\bar{x}}\)</span>,where
<span class="math inline">\(\bar{x}\)</span> is the sample mean.The
expectation of <span class="math inline">\(\hat\lambda\)</span> is <span class="math inline">\(\lambda n/(n - 1)\)</span>,the standard error
<span class="math inline">\(\lambda\)</span> is <span class="math inline">\(\lambda n/[(n - 1)\sqrt{n-2}]\)</span>.Conduct a
simulation study to verify the performance of the bootstrap method.
Where the true value of <span class="math inline">\(\lambda =
2\)</span>,the sample size <span class="math inline">\(n =
5,10,20\)</span>,the number of bootstrap replicates <span class="math inline">\(B =1000\)</span>,the simulations are repeated for
<span class="math inline">\(m = 1000\)</span> times. Compare the mean
bootstrap bias and bootstrap standard error with the theoretical
ones.Comment on the results.</p>
</div>
<div id="answer-16" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># theoretical bias and se</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>theoretical <span class="ot">&lt;-</span> <span class="cf">function</span>(n,lambda){</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> lambda<span class="sc">/</span>(n<span class="dv">-1</span>)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  se <span class="ot">&lt;-</span> lambda <span class="sc">*</span>n<span class="sc">/</span>((n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">sqrt</span>(n<span class="dv">-2</span>))</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(bias,se))</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>}</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co"># bias and se by the bootstrap</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="cf">function</span>(x,n,lambda,B){</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  thetastar <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B)</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>    xstar <span class="ot">&lt;-</span> <span class="fu">sample</span>(x,<span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>    thetastar[i] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(xstar)</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>  }</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">c</span>(<span class="at">bias=</span><span class="fu">mean</span>(thetastar)<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(x),<span class="at">se.boot =</span> <span class="fu">sd</span>(thetastar)))</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>}</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#repeat the sumulations for 1000 times</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> se <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)</span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n,lambda)</span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>    bias[i] <span class="ot">&lt;-</span> <span class="fu">boots</span>(x,n,lambda,B)[<span class="dv">1</span>]</span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>    se[i] <span class="ot">&lt;-</span> <span class="fu">boots</span>(x,n,lambda,B)[<span class="dv">2</span>]</span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>  }</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">mean</span>(bias),<span class="fu">mean</span>(se))</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>}</span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a>  <span class="at">bootstrap =</span> <span class="fu">c</span>(<span class="fu">result</span>(<span class="dv">5</span>)[<span class="dv">1</span>],<span class="fu">result</span>(<span class="dv">10</span>)[<span class="dv">1</span>],<span class="fu">result</span>(<span class="dv">20</span>)[<span class="dv">1</span>]),</span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a>  <span class="at">theor =</span> <span class="fu">c</span>(<span class="fu">theoretical</span>(<span class="dv">5</span>,<span class="dv">2</span>)[<span class="dv">1</span>],<span class="fu">theoretical</span>(<span class="dv">10</span>,<span class="dv">2</span>)[<span class="dv">1</span>],<span class="fu">theoretical</span>(<span class="dv">20</span>,<span class="dv">2</span>)[<span class="dv">1</span>]),</span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>)</span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a>)</span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a>  <span class="at">bootstrap =</span> <span class="fu">c</span>(<span class="fu">result</span>(<span class="dv">5</span>)[<span class="dv">2</span>],<span class="fu">result</span>(<span class="dv">10</span>)[<span class="dv">2</span>],<span class="fu">result</span>(<span class="dv">20</span>)[<span class="dv">2</span>]),</span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a>  <span class="at">theor =</span> <span class="fu">c</span>(<span class="fu">theoretical</span>(<span class="dv">5</span>,<span class="dv">2</span>)[<span class="dv">2</span>],<span class="fu">theoretical</span>(<span class="dv">10</span>,<span class="dv">2</span>)[<span class="dv">2</span>],<span class="fu">theoretical</span>(<span class="dv">20</span>,<span class="dv">2</span>)[<span class="dv">2</span>]),</span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>)</span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a>)</span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a><span class="fu">print</span>(bias)</span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a><span class="fu">print</span>(se)</span></code></pre></div>
</div>
<div id="question-12" class="section level2">
<h2>Question</h2>
<p>Obtain a bootstrap t confidence interval estimate for the correlation
statistic in Example 7.2 (law data in bootstrap).</p>
</div>
<div id="answer-17" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">data</span>(law,<span class="at">package =</span> <span class="st">&quot;bootstrap&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>boot.t.ci <span class="ot">&lt;-</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="cf">function</span>(x, <span class="at">B =</span> <span class="dv">500</span>, <span class="at">R =</span> <span class="dv">100</span>, <span class="at">level =</span> .<span class="dv">95</span>, statistic){</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="co">#compute the bootstrap t CI</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x); n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  stat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B); se <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  boot.se <span class="ot">&lt;-</span> <span class="cf">function</span>(x, R, f) {</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>    <span class="co">#local function to compute the bootstrap</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>    <span class="co">#estimate of standard error for statistic f(x)</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x); m <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>    th <span class="ot">&lt;-</span> <span class="fu">replicate</span>(R, <span class="at">expr =</span> {</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>      i <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>m, <span class="at">size =</span> m, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>      <span class="fu">f</span>(x[i, ])</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>      })</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sd</span>(th))</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>  }</span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>    j <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>    y <span class="ot">&lt;-</span> x[j, ]</span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>    stat[b] <span class="ot">&lt;-</span> <span class="fu">statistic</span>(y)</span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>    se[b] <span class="ot">&lt;-</span> <span class="fu">boot.se</span>(y, <span class="at">R =</span> R, <span class="at">f =</span> statistic)</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>  }</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>  stat0 <span class="ot">&lt;-</span> <span class="fu">statistic</span>(x)</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>  t.stats <span class="ot">&lt;-</span> (stat <span class="sc">-</span> stat0) <span class="sc">/</span> se</span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>  se0 <span class="ot">&lt;-</span> <span class="fu">sd</span>(stat)</span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> level</span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>  Qt <span class="ot">&lt;-</span> <span class="fu">quantile</span>(t.stats, <span class="fu">c</span>(alpha<span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>), <span class="at">type =</span> <span class="dv">1</span>)</span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a>  <span class="fu">names</span>(Qt) <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">names</span>(Qt))</span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>  CI <span class="ot">&lt;-</span> <span class="fu">rev</span>(stat0 <span class="sc">-</span> Qt <span class="sc">*</span> se0)</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a>}</span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>stat <span class="ot">&lt;-</span> <span class="cf">function</span>(x,i){<span class="fu">cor</span>(x[i,<span class="dv">1</span>],x[i,<span class="dv">2</span>])}</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">boot.t.ci</span>(law,<span class="at">statistic =</span> stat,<span class="at">B=</span><span class="dv">2000</span>,<span class="at">R=</span><span class="dv">200</span>)</span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a><span class="fu">print</span>(ci)</span></code></pre></div>
</div>
<div id="question-13" class="section level2">
<h2>Question</h2>
<p>Compute 95% bootstrap confidence intervals for the mean time between
failures <span class="math inline">\(\frac{1}{\lambda}\)</span> by the
standard normal, basic, percentile,and BCa methods.Compare the intervals
and explain why they may differ.</p>
</div>
<div id="answer-18" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span>;</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>obser <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">18</span>,<span class="dv">43</span>,<span class="dv">85</span>,<span class="dv">91</span>,<span class="dv">98</span>,<span class="dv">100</span>,<span class="dv">130</span>,<span class="dv">230</span>,<span class="dv">487</span>)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>boot.mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x,i) <span class="fu">mean</span>(x[i])</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>ci.norm <span class="ot">&lt;-</span> ci.basic <span class="ot">&lt;-</span> ci.perc <span class="ot">&lt;-</span> ci.bca <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>de <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>obser,<span class="at">statistic =</span> boot.mean,<span class="at">R=</span><span class="dv">2000</span>)</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(de,<span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;basic&quot;</span>,<span class="st">&quot;perc&quot;</span>,<span class="st">&quot;bca&quot;</span>))</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="fu">print</span>(ci)</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#compute the  mean lengths of the intervals</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>norm.len <span class="ot">&lt;-</span> basic.len <span class="ot">&lt;-</span> perc.len <span class="ot">&lt;-</span> bca.len <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m){</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(de,<span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;basic&quot;</span>,<span class="st">&quot;perc&quot;</span>,<span class="st">&quot;bca&quot;</span>))</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>  norm.len[i] <span class="ot">&lt;-</span> ci<span class="sc">$</span>norm[<span class="dv">3</span>]<span class="sc">-</span>ci<span class="sc">$</span>norm[<span class="dv">2</span>]</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>  basic.len[i] <span class="ot">&lt;-</span> ci<span class="sc">$</span>basic[<span class="dv">5</span>]<span class="sc">-</span>ci<span class="sc">$</span>basic[<span class="dv">4</span>]</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>  perc.len[i] <span class="ot">&lt;-</span> ci<span class="sc">$</span>perc[<span class="dv">5</span>]<span class="sc">-</span>ci<span class="sc">$</span>perc[<span class="dv">4</span>]</span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>  bca.len[i] <span class="ot">&lt;-</span> ci<span class="sc">$</span>bca[<span class="dv">5</span>]<span class="sc">-</span>ci<span class="sc">$</span>bca[<span class="dv">4</span>]</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>}</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="fu">mean</span>(norm.len),<span class="fu">mean</span>(basic.len),<span class="fu">mean</span>(perc.len),<span class="fu">mean</span>(bca.len)))</span></code></pre></div>
<p>Although the confidence intervals using the basic and percent methods
are the same length,we can see that the upper and lower bounds for each
confidence interval are different.I think this is mainly due to the
small amount of data in the original sample and a certain bias to the
left.</p>
</div>
<div id="question-14" class="section level2">
<h2>Question</h2>
<p>Refer to Exercise 7.7. Obtain the jackknife estimates of bias and
standard error of <span class="math inline">\(\hat{\theta}\)</span>.</p>
</div>
<div id="answer-19" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">library</span>(bootstrap)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">attach</span>(scor)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(scor)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(data[,<span class="dv">1</span>])</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co">#the function of theta</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>scores.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x,i){</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>  <span class="fu">eigen</span>(<span class="fu">cov</span>(x))<span class="sc">$</span>values[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">eigen</span>(<span class="fu">cov</span>(x))<span class="sc">$</span>values)</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>}</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> <span class="fu">eigen</span>(<span class="fu">cov</span>(data))<span class="sc">$</span>values[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">eigen</span>(<span class="fu">cov</span>(data))<span class="sc">$</span>values)</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>theta.jack <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>  theta.jack[i] <span class="ot">&lt;-</span> <span class="fu">scores.fun</span>(data[<span class="sc">-</span>i,])</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>}</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>bias.jack <span class="ot">&lt;-</span> (n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">mean</span>((theta.jack)<span class="sc">-</span>theta.hat)</span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>se.jack <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">mean</span>((theta.jack<span class="sc">-</span>theta.hat)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(<span class="at">original=</span>theta.hat,<span class="at">bias.jack=</span>bias.jack,<span class="at">se.jack=</span>se.jack),<span class="dv">3</span>)</span></code></pre></div>
</div>
<div id="question-15" class="section level2">
<h2>Question</h2>
<p>In Example 7.18,leave-one-out(n-fold) cross validation was used to
select the best fitting model.Use leave-two-out cross validation to
compare the models.</p>
</div>
<div id="answer-20" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">attach</span>(ironslag)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(magnetic)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> e2 <span class="ot">&lt;-</span> e3 <span class="ot">&lt;-</span>e4 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,n,n<span class="dv">-1</span>)</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co"># for n-fold cross validation</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co"># fit models on leave-two-out samples</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>  y <span class="ot">&lt;-</span> magnetic[<span class="sc">-</span>k]</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  x <span class="ot">&lt;-</span> chemical[<span class="sc">-</span>k]</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)){</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>    z <span class="ot">&lt;-</span> y[<span class="sc">-</span>j]</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>    w <span class="ot">&lt;-</span> x[<span class="sc">-</span>j]</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>    </span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>    J1 <span class="ot">&lt;-</span> <span class="fu">lm</span>( z<span class="sc">~</span> w)</span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>    yhat1 <span class="ot">&lt;-</span> J1<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J1<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> x[j]</span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>    e1[k,j] <span class="ot">&lt;-</span> y[j] <span class="sc">-</span> yhat1</span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a>    L2 <span class="ot">&lt;-</span> <span class="fu">lm</span>( z <span class="sc">~</span> w <span class="sc">+</span> <span class="fu">I</span>(w<span class="sc">^</span><span class="dv">2</span>) )</span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>    yhat2 <span class="ot">&lt;-</span> L2<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> L2<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> x[j] <span class="sc">+</span></span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a>             L2<span class="sc">$</span>coef[<span class="dv">3</span>] <span class="sc">*</span> x[j]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>    e2[k,j] <span class="ot">&lt;-</span> y[j] <span class="sc">-</span> yhat2</span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a>    L3 <span class="ot">&lt;-</span> <span class="fu">lm</span>( <span class="fu">log</span>(z) <span class="sc">~</span> w )</span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a>    logyhat3 <span class="ot">&lt;-</span> L3<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> L3<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> x[j]</span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a>    yhat3 <span class="ot">&lt;-</span> <span class="fu">exp</span>( logyhat3 )</span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a>    e3[k,j] <span class="ot">&lt;-</span> y[j] <span class="sc">-</span> yhat3</span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a>    L4 <span class="ot">&lt;-</span> <span class="fu">lm</span>( <span class="fu">log</span>(z) <span class="sc">~</span> <span class="fu">log</span>(w) )</span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a>    logyhat4 <span class="ot">&lt;-</span> L4<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> L4<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">log</span>(x[j])</span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a>    yhat4 <span class="ot">&lt;-</span> <span class="fu">exp</span>( logyhat4 )</span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a>    e4[k,j] <span class="ot">&lt;-</span> y[j] <span class="sc">-</span> yhat4</span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a>  }</span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a>}</span>
<span id="cb23-34"><a href="#cb23-34" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">mean</span>(e1<span class="sc">^</span><span class="dv">2</span>),<span class="fu">mean</span>(e2<span class="sc">^</span><span class="dv">2</span>),<span class="fu">mean</span>(e3<span class="sc">^</span><span class="dv">2</span>),<span class="fu">mean</span>(e4<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<p>We can see that L2 is the best model.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="fu">plot</span>(L2<span class="sc">$</span>fit, L2<span class="sc">$</span>res)<span class="co">#residuals vs fitted values</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)        <span class="co">#reference line</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="fu">qqnorm</span>(L2<span class="sc">$</span>res)      <span class="co">#normal probability plot</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="fu">qqline</span>(L2<span class="sc">$</span>res)      <span class="co">#reference line</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
</div>
<div id="question-16" class="section level2">
<h2>Question</h2>
<p>Proof the Stationarity of Metropolis-Hastings sampler Algorithm in
continuous situation.</p>
</div>
<div id="answer-21" class="section level2">
<h2>Answer</h2>
<p>If the support <span class="math inline">\(S\)</span> of the target
distribution is a continuous set, note <span class="math inline">\(f\)</span> as the probability density function of
the target distribution.Note: <span class="math display">\[Q:proposal \
distribution \ function\\
q(·|x):proposal\ probability \ density\ function ,for\ any\ x
\]</span> Then,the acceptance probability<span class="math inline">\(\alpha(x,y)=min
\{1,\frac{f(y)q(x|y)}{f(x)q(y|x)}\}\)</span> we have <span class="math inline">\(f(x)q(y|x)&gt;0,for\ all\ (x,y)\)</span>,so the
Markov chain transition kernel is <span class="math display">\[p(x,y)=q(y|x)\alpha(x,y)=q(y|x)min\{1,\frac{f(y)q(x|y)}{f(x)q(y|x)}\}\]</span>
Then, <span class="math display">\[p(x,y)f(x)=f(x)q(y|x)\alpha(x,y)=p(y,x)f(y)\]</span>
Integrate both sides of the Detailed Balance Equation,we have <span class="math display">\[\int p(x,y)f(x)dx=\int p(y,x)f(y)dx
\Longleftrightarrow f(y)=\int p(x,y)f(x)dx\]</span> Thus,we know that
<span class="math inline">\(f\)</span> is stationary distribution from
the definition of stationary distribution.</p>
</div>
<div id="question-8.1" class="section level2">
<h2>Question 8.1</h2>
<p>Implement the two-sample Cramér-von Mises test for equal
distributions as a permutation test.Apply the test to the data in
Examples 8.1 and 8.2.</p>
</div>
<div id="answer-22" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">attach</span>(chickwts)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.vector</span>(weight[feed <span class="sc">==</span> <span class="st">&quot;soybean&quot;</span>]))</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.vector</span>(weight[feed <span class="sc">==</span> <span class="st">&quot;linseed&quot;</span>]))</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">c</span>(x,y)</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="fu">detach</span>(chickwts)</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="dv">999</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>dos <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r)</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">#the cramer-von Mises Statistic</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>w2 <span class="ot">&lt;-</span> <span class="cf">function</span>(n1,m1){</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  sd1 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  sd2 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> <span class="fu">sort</span>(n1)</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>  m2 <span class="ot">&lt;-</span> <span class="fu">sort</span>(m1)</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>      k1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>      <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m){</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>        <span class="cf">if</span> (n2[j] <span class="sc">&lt;=</span> m2[k]){</span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>          k1 <span class="ot">&lt;-</span> k1 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>        }</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>      }</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>      sd1[j] <span class="ot">&lt;-</span> ((j<span class="sc">/</span>n)<span class="sc">-</span>(k1<span class="sc">/</span>m))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>  }</span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>  <span class="cf">for</span> (j1 <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m){</span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>      k2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>      <span class="cf">for</span> (k3 <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>        <span class="cf">if</span> (m2[j1] <span class="sc">&lt;=</span> n2[k3]){</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>          k2 <span class="ot">&lt;-</span> k2 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>        }</span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>      }</span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>      sd2[j1] <span class="ot">&lt;-</span> ((j1<span class="sc">/</span>m)<span class="sc">-</span>(k2<span class="sc">/</span>n))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>    }</span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>  m<span class="sc">*</span>n<span class="sc">*</span>(<span class="fu">sum</span>(sd1)<span class="sc">+</span><span class="fu">sum</span>(sd2))<span class="sc">/</span>(m<span class="sc">+</span>n)<span class="sc">^</span><span class="dv">2</span>  </span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a>}</span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(z)</span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>r){</span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a>  sam <span class="ot">&lt;-</span> <span class="fu">sample</span>(l,n,<span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> z[sam]</span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> z[<span class="sc">-</span>sam]</span>
<span id="cb25-42"><a href="#cb25-42" tabindex="-1"></a>  dos[i] <span class="ot">&lt;-</span> <span class="fu">w2</span>(x1,x2)</span>
<span id="cb25-43"><a href="#cb25-43" tabindex="-1"></a>}</span>
<span id="cb25-44"><a href="#cb25-44" tabindex="-1"></a>do <span class="ot">&lt;-</span><span class="fu">w2</span>(x,y)</span>
<span id="cb25-45"><a href="#cb25-45" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(do,dos) <span class="sc">&gt;=</span> do)</span>
<span id="cb25-46"><a href="#cb25-46" tabindex="-1"></a>p</span></code></pre></div>
<p>Here the sample evidence do not supports the alternative hypothesis
that the distributions differ.</p>
</div>
<div id="question-8.3" class="section level2">
<h2>Question 8.3</h2>
<p>The Count 5 test for equal variances in Section 6.4 is based on the
maximum number of extreme points. Example 6.15 shows that the Count 5
criterion is not applicable for unequal sample sizes. Implement a
permutation test for equal variance based on the maximum number of
extreme points that applies when sample sizes are not necessarily
equal.</p>
</div>
<div id="answer-23" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>c5t <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y){</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>  X <span class="ot">&lt;-</span> x <span class="sc">-</span> <span class="fu">mean</span>(x)</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="fu">mean</span>(y)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>  outx <span class="ot">&lt;-</span> <span class="fu">sum</span>(X <span class="sc">&gt;</span> <span class="fu">max</span>(Y)) <span class="sc">+</span> <span class="fu">sum</span>(X <span class="sc">&lt;</span> <span class="fu">min</span>(Y))</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>  outy <span class="ot">&lt;-</span> <span class="fu">sum</span>(Y <span class="sc">&gt;</span> <span class="fu">max</span>(X)) <span class="sc">+</span> <span class="fu">sum</span>(Y <span class="sc">&lt;</span> <span class="fu">min</span>(X))</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(outx,outy))</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>}</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>nu1 <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>nu2 <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> mu2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span> sigma2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,r,<span class="dv">2</span>)</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(nu1, mu1, sigma1)</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(nu2, mu2, sigma2)</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">c</span>(x,y)</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(N)</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>DO <span class="ot">&lt;-</span> <span class="fu">c5t</span>(x,y)</span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>r){</span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(l,<span class="fu">length</span>(x),<span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> N[n1]</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>  y1 <span class="ot">&lt;-</span> N[<span class="sc">-</span>n1]</span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> <span class="fu">c5t</span>(x1,y1)</span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>  D[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> pt[<span class="dv">1</span>]</span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a>  D[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> pt[<span class="dv">2</span>]</span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a>}</span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a>K1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>r){</span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a>  <span class="cf">if</span> (D[i,<span class="dv">1</span>]<span class="sc">&gt;=</span>DO[<span class="dv">1</span>] <span class="sc">&amp;</span> D[i,<span class="dv">2</span>] <span class="sc">&gt;=</span> DO[<span class="dv">2</span>]){</span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a>    K1 <span class="ot">&lt;-</span> K1 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a>  }</span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a>}</span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a>p <span class="ot">&lt;-</span> K1<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb26-37"><a href="#cb26-37" tabindex="-1"></a>p</span></code></pre></div>
<p>We can know that p values &gt;0.05,do not reject the null
hypothesis.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">data</span>(schools) <span class="co"># a real dataset</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>J <span class="ot">&lt;-</span> <span class="fu">nrow</span>(schools)</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>y <span class="ot">&lt;-</span> schools<span class="sc">$</span>estimate</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>sigma.y <span class="ot">&lt;-</span> schools<span class="sc">$</span>sd</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span> (<span class="st">&quot;N&quot;</span>, <span class="st">&quot;J&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;sigma.y&quot;</span>)</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">theta =</span> <span class="fu">rnorm</span>(J, <span class="dv">0</span>, <span class="dv">100</span>), <span class="at">mu.theta =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>    <span class="at">sigma.theta =</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>}</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>schools.sim <span class="ot">&lt;-</span> <span class="fu">bugs</span>(data, inits, <span class="at">model.file =</span> <span class="st">&quot;schools.txt&quot;</span>,</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>                    <span class="at">parameters =</span> <span class="fu">c</span>(<span class="st">&quot;theta&quot;</span>, <span class="st">&quot;mu.theta&quot;</span>, <span class="st">&quot;sigma.theta&quot;</span>),</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>                    <span class="at">n.chains =</span> <span class="dv">3</span>, <span class="at">n.iter =</span> N, <span class="at">codaPkg=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="question-17" class="section level2">
<h2>Question</h2>
<p>Consider a model <span class="math inline">\(P(Y=1|X_1,X_2,X_3)=\frac{exp(a+b_1X_1+b_2X_2+b_3X_3)}{1+exp(a+b_1X_1+b_2X_2+b_3X_3)}\)</span>,where
<span class="math inline">\(X_1 \sim P(1) ,X_2 \sim Exp(1),and\ X_3 \sim
B(1,0.5)\)</span> 1) Design a specify function which produces the
output. 2) Use the function to compare a with <span class="math inline">\(-logf_0\)</span></p>
</div>
<div id="answer-24" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>ln <span class="ot">&lt;-</span> <span class="cf">function</span>(N,b1,b2,b3,f0){</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">rpois</span>(N,<span class="dv">1</span>)</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> <span class="fu">rexp</span>(N,<span class="dv">1</span>)</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>  x3 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,N,<span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha){</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>alpha<span class="sc">-</span>b1<span class="sc">*</span>x1<span class="sc">-</span>b2<span class="sc">*</span>x2<span class="sc">-</span>b3<span class="sc">*</span>x3)</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>tmp)</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>    <span class="fu">mean</span>(pval) <span class="sc">-</span> f0</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>  }</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>  solution <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(p,<span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>,<span class="dv">0</span>)) <span class="co">#let p value &lt; 0.1</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>  solution<span class="sc">$</span>root</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>}</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fl">10e6</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">0</span>;b2 <span class="ot">&lt;-</span> <span class="dv">1</span>;b3 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>f0 <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">ln</span>(N,b1,b2,b3,f0)</span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">ln</span>(N,b1,b2,b3,f0<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> <span class="fu">ln</span>(N,b1,b2,b3,f0<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>a4 <span class="ot">&lt;-</span> <span class="fu">ln</span>(N,b1,b2,b3,f0<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(a1,a2,a3,a4)</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fu">log</span>(f0),<span class="sc">-</span><span class="fu">log</span>(f0<span class="sc">/</span><span class="dv">10</span>),<span class="sc">-</span><span class="fu">log</span>(f0<span class="sc">/</span><span class="dv">100</span>),<span class="sc">-</span><span class="fu">log</span>(f0<span class="sc">/</span><span class="dv">1000</span>))</span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span></code></pre></div>
<p>Thus,we can see that <span class="math inline">\(-logf_0\)</span> is
linear correlated with a.</p>
</div>
<div id="question-9.4" class="section level2">
<h2>Question 9.4</h2>
<p>Implement a random walk Metropolis sampler for generating the
standard Laplace distribution.For the increment, simulate from a normal
distribution.Compare the chains generated when different variances are
used for the proposal distribution.Also,compute the acceptance rates of
each chain.</p>
</div>
<div id="answer-25" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) (<span class="fu">exp</span>(<span class="sc">-</span><span class="fu">abs</span>(x)))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>rw.Metropolis <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma, x0, N) {</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>    x[<span class="dv">1</span>] <span class="ot">&lt;-</span> x0</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, x[i<span class="dv">-1</span>], sigma)</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>        <span class="cf">if</span> (u[i] <span class="sc">&lt;=</span> (<span class="fu">exp</span>(<span class="sc">-</span><span class="fu">abs</span>(y))<span class="sc">/</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">abs</span>(x[i<span class="dv">-1</span>]))))</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>        x[i] <span class="ot">&lt;-</span> y  <span class="cf">else</span> {</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>            x[i] <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>            k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a>        }</span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>      }</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">x=</span>x, <span class="at">k=</span>N<span class="sc">-</span>k))</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>    }</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">16</span>) <span class="co">#four different sigma</span></span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a>rw1 <span class="ot">&lt;-</span> <span class="fu">rw.Metropolis</span>(sigma[<span class="dv">1</span>], x0, N)</span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a>rw2 <span class="ot">&lt;-</span> <span class="fu">rw.Metropolis</span>(sigma[<span class="dv">2</span>], x0, N)</span>
<span id="cb29-25"><a href="#cb29-25" tabindex="-1"></a>rw3 <span class="ot">&lt;-</span> <span class="fu">rw.Metropolis</span>(sigma[<span class="dv">3</span>], x0, N)</span>
<span id="cb29-26"><a href="#cb29-26" tabindex="-1"></a>rw4 <span class="ot">&lt;-</span> <span class="fu">rw.Metropolis</span>(sigma[<span class="dv">4</span>], x0, N)</span>
<span id="cb29-27"><a href="#cb29-27" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" tabindex="-1"></a><span class="co">#number of candidate points accepted</span></span>
<span id="cb29-29"><a href="#cb29-29" tabindex="-1"></a>acceptance <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sigma=</span>sigma,<span class="at">acceptance=</span><span class="fu">c</span>(rw1<span class="sc">$</span>k, rw2<span class="sc">$</span>k, rw3<span class="sc">$</span>k, rw4<span class="sc">$</span>k))</span>
<span id="cb29-30"><a href="#cb29-30" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(acceptance)</span></code></pre></div>
<p>Compare the chains by the line plot.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))  <span class="co">#display 4 graphs together</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>    rw <span class="ot">&lt;-</span> <span class="fu">cbind</span>(rw1<span class="sc">$</span>x, rw2<span class="sc">$</span>x, rw3<span class="sc">$</span>x,  rw4<span class="sc">$</span>x)</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>        <span class="fu">plot</span>(rw[,j], <span class="at">type=</span><span class="st">&quot;l&quot;</span>,</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>             <span class="at">xlab=</span><span class="fu">bquote</span>(sigma <span class="sc">==</span> .(<span class="fu">round</span>(sigma[j],<span class="dv">3</span>))),</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>             <span class="at">ylab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylim=</span><span class="fu">range</span>(rw[,j]))</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>    }</span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co">#reset to default</span></span></code></pre></div>
<p>We can see that the chain in the third plot(<span class="math inline">\(\sigma=4\)</span>) is mixing well and converging
to the target distribution after a short period.</p>
</div>
<div id="question-9.7" class="section level2">
<h2>Question 9.7</h2>
<p>Implement a Gibbs sampler to generate a bivariate normal chain <span class="math inline">\((X_t, Y_t)\)</span> with zero means,unit standard
deviations,and correlation 0.9.Plot the generated sample after
discarding a suitable burn-in sample.Fit a simple linear regression
model <span class="math inline">\(Y = β_0 + β_1X\)</span> to the sample
and check the residuals of the model for normality and constant
variance.</p>
</div>
<div id="answer-26" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co">#initialize constants and parameters</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">5000</span> <span class="co">#length of chain</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co">#burn-in length</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, N, <span class="dv">2</span>) <span class="co">#the chain, a bivariate sample</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.9</span> <span class="co">#correlation</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>mu2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">-</span>rho<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>sigma1</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">-</span>rho<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>sigma2</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="co"># generate the chain</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>X[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(mu1, mu2) <span class="co">#initialize</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> X[i<span class="dv">-1</span>, <span class="dv">2</span>]</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  m1 <span class="ot">&lt;-</span> mu1 <span class="sc">+</span> rho <span class="sc">*</span> (x2 <span class="sc">-</span> mu2) <span class="sc">*</span> sigma1<span class="sc">/</span>sigma2</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>  X[i, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, m1, s1)</span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> X[i, <span class="dv">1</span>]</span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>  m2 <span class="ot">&lt;-</span> mu2 <span class="sc">+</span> rho <span class="sc">*</span> (x1 <span class="sc">-</span> mu1) <span class="sc">*</span> sigma2<span class="sc">/</span>sigma1</span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a>  X[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, m2, s2)</span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a>}</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a>b <span class="ot">&lt;-</span> burn <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>x <span class="ot">&lt;-</span> X[b<span class="sc">:</span>N, ]</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">cex=</span>.<span class="dv">5</span>, <span class="at">xlab=</span><span class="fu">bquote</span>(X[<span class="dv">1</span>]),<span class="at">ylab=</span><span class="fu">bquote</span>(X[<span class="dv">2</span>]), <span class="at">ylim=</span><span class="fu">range</span>(x[,<span class="dv">2</span>]))</span></code></pre></div>
<p>Now fit the simple linear regression model</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>Y <span class="ot">&lt;-</span> x[,<span class="dv">2</span>]</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>X <span class="ot">&lt;-</span> x[,<span class="dv">1</span>]</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x)</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>lreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y<span class="sc">~</span>X,<span class="at">data=</span>dat)</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="co">#normality test</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lreg)</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="fu">shapiro.test</span>(res) <span class="co"># p value &gt; 0.05,we do not reject the null hypothesis</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="co">#plot(density(res))</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="fu">plot</span>(lreg)</span></code></pre></div>
<p>Thus,the residuals have the normality and constant variance.</p>
</div>
<div id="question-9.10" class="section level2">
<h2>Question 9.10</h2>
<p>Refer to Example 9.1. Use the Gelman-Rubin method to monitor
convergence of the chain, and run the chain until the chain has
converged approximately to the target distribution according to <span class="math inline">\(\hat{R}&lt;1.2\)</span>.Also use the coda package
to check for convergence of the chain by the Gelman-Rubin method.</p>
</div>
<div id="answer-27" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, sigma) {</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(x <span class="sc">&lt;</span> <span class="dv">0</span>)) <span class="fu">return</span> (<span class="dv">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  <span class="fu">stopifnot</span>(sigma <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  <span class="fu">return</span>((x <span class="sc">/</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>}</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>Gelman.Rubin <span class="ot">&lt;-</span> <span class="cf">function</span>(psi) {</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>    <span class="co"># psi[i,j] is the statistic psi(X[i,1:j])</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>    <span class="co"># for chain in i-th row of X</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>    psi <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(psi)</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(psi)</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="fu">nrow</span>(psi)</span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>    psi.means <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(psi)     <span class="co">#row means</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>    B <span class="ot">&lt;-</span> n <span class="sc">*</span> <span class="fu">var</span>(psi.means)        <span class="co">#between variance est.</span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>    psi.w <span class="ot">&lt;-</span> <span class="fu">apply</span>(psi, <span class="dv">1</span>, <span class="st">&quot;var&quot;</span>)  <span class="co">#within variances</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>    W <span class="ot">&lt;-</span> <span class="fu">mean</span>(psi.w)               <span class="co">#within est.</span></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>    v.hat <span class="ot">&lt;-</span> W<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span>n <span class="sc">+</span> (B<span class="sc">/</span>n)     <span class="co">#upper variance est.</span></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>    r.hat <span class="ot">&lt;-</span> v.hat <span class="sc">/</span> W             <span class="co">#G-R statistic</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>    <span class="fu">return</span>(r.hat)</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>    }</span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>chisq.chain <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma, N){</span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a>    <span class="co">#with chisq(df=x) proposal distribution</span></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a>    <span class="co">#and starting value X1</span></span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a>    x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(<span class="dv">1</span>,<span class="at">df=</span><span class="dv">1</span>)</span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a>      xt <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(<span class="dv">1</span>,<span class="at">df =</span> xt)     <span class="co">#candidate point</span></span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a>      r1 <span class="ot">&lt;-</span> <span class="fu">f</span>(y,sigma) <span class="sc">*</span> <span class="fu">dchisq</span>(xt,<span class="at">df =</span> y)</span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a>      r2 <span class="ot">&lt;-</span> <span class="fu">f</span>(xt,sigma) <span class="sc">*</span> <span class="fu">dchisq</span>(y,<span class="at">df =</span> xt)</span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a>      <span class="cf">if</span> (u[i] <span class="sc">&lt;=</span> r1<span class="sc">/</span>r2) x[i] <span class="ot">&lt;-</span> y <span class="cf">else</span></span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a>        x[i] <span class="ot">&lt;-</span> xt</span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a>    }</span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a>}</span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a></span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a>    sigma <span class="ot">&lt;-</span> <span class="dv">4</span>    <span class="co">#parameter of proposal distribution</span></span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="dv">4</span>          <span class="co">#number of chains to generate</span></span>
<span id="cb33-42"><a href="#cb33-42" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="dv">20000</span>     <span class="co">#length of chains</span></span>
<span id="cb33-43"><a href="#cb33-43" tabindex="-1"></a>    b <span class="ot">&lt;-</span> <span class="dv">1000</span>       <span class="co">#burn-in length</span></span>
<span id="cb33-44"><a href="#cb33-44" tabindex="-1"></a></span>
<span id="cb33-45"><a href="#cb33-45" tabindex="-1"></a>    <span class="co">#generate the chains</span></span>
<span id="cb33-46"><a href="#cb33-46" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>k, <span class="at">ncol=</span>n)</span>
<span id="cb33-47"><a href="#cb33-47" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k)</span>
<span id="cb33-48"><a href="#cb33-48" tabindex="-1"></a>        X[i, ] <span class="ot">&lt;-</span> <span class="fu">chisq.chain</span>(sigma, n)</span>
<span id="cb33-49"><a href="#cb33-49" tabindex="-1"></a></span>
<span id="cb33-50"><a href="#cb33-50" tabindex="-1"></a>    <span class="co">#compute diagnostic statistics</span></span>
<span id="cb33-51"><a href="#cb33-51" tabindex="-1"></a>    psi <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(X, <span class="dv">1</span>, cumsum))</span>
<span id="cb33-52"><a href="#cb33-52" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(psi))</span>
<span id="cb33-53"><a href="#cb33-53" tabindex="-1"></a>        psi[i,] <span class="ot">&lt;-</span> psi[i,] <span class="sc">/</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(psi))</span>
<span id="cb33-54"><a href="#cb33-54" tabindex="-1"></a><span class="co">#plot psi for the four chains</span></span>
<span id="cb33-55"><a href="#cb33-55" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k)</span>
<span id="cb33-56"><a href="#cb33-56" tabindex="-1"></a>  <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb33-57"><a href="#cb33-57" tabindex="-1"></a>    <span class="fu">plot</span>((b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n,psi[i, (b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n],<span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">4.5</span>,<span class="fl">5.5</span>), <span class="at">type=</span><span class="st">&quot;l&quot;</span>,</span>
<span id="cb33-58"><a href="#cb33-58" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">&#39;Index&#39;</span>, <span class="at">ylab=</span><span class="fu">bquote</span>(phi))</span>
<span id="cb33-59"><a href="#cb33-59" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb33-60"><a href="#cb33-60" tabindex="-1"></a>  <span class="fu">lines</span>(psi[i, (b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n], <span class="at">col=</span>i)</span>
<span id="cb33-61"><a href="#cb33-61" tabindex="-1"></a>  }</span>
<span id="cb33-62"><a href="#cb33-62" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>    <span class="co">#plot the sequence of R-hat statistics</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>    rhat <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> (b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n)</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>        rhat[j] <span class="ot">&lt;-</span> <span class="fu">Gelman.Rubin</span>(psi[,<span class="dv">1</span><span class="sc">:</span>j])</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>    <span class="fu">plot</span>(rhat[(b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;R&quot;</span>)</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h=</span><span class="fl">1.2</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p>Then we can see the <span class="math inline">\(\hat{R}&lt;1.2\)</span>,use the coda package to
check for convergence of the chain by the Gelman-Rubin method.</p>
</div>
<div id="question-18" class="section level2">
<h2>Question</h2>
<p>Let <span class="math inline">\(X_1,\ldots,X_n
\stackrel{i.i.d}{\sim}Exp(\lambda)\)</span>,we only know that <span class="math inline">\(X_i\)</span> belong to some intervals <span class="math inline">\([u_i,v_i]\)</span>. (1)use MLE and EM algorithm to
estimate <span class="math inline">\(\lambda\)</span>,and prove the
convergence of EM algorithm to MLE. (2)observed
valus:(11,12),(8,9),(27,28),(13,14),(16,17),(0,1),(23,24),(10,11),(24,25),(2,3).Implementing
numerical solutions for MLE and EM algorithms</p>
</div>
<div id="answer-28" class="section level2">
<h2>Answer</h2>
<p>(1)MLE The likelihood function <span class="math display">\[L(\theta)
= \prod_{i=1}^nP_\lambda (u_i\leq X_i \leq v_i),when\ X_1 ,\ldots,
Xi\sim exp(\lambda)\]</span> <span class="math display">\[\begin{aligned}
l(\theta) &amp;= log\prod_{i=1}^nP_\lambda (u_i\leq X_i \leq v_i)\\
&amp;=\Sigma_{i=1}^n log(1-e^{\lambda(u_i-v_i)})e^{-\lambda u_i} \\
&amp;= \Sigma_{i=1}^{n} [-\lambda u_i +log(1-e^{\lambda(u_i-v_i)})]
\end{aligned}\]</span> Then, <span class="math display">\[H(\lambda)=\frac{d}{d\lambda}l(\lambda)=-\Sigma_{i=1}^{n}u_i+\Sigma_{i=1}^{n}\frac{-(u_i-v_i)e^{\lambda(u_i-v_i)}}{1-e^{\lambda(u_i-v_i)}}\\
\frac{d}{d\lambda}H(\lambda)=\Sigma_{i=1}^{n}\frac{-(u_i-v_i)^2e^{\lambda(u_i-v_i)}}{1-e^{\lambda(u_i-v_i)}}&lt;0\]</span>
Thus,H(<span class="math inline">\(\lambda\)</span>) is a decreasing
function,so when set <span class="math inline">\(\lambda^*\)</span>
<span class="math inline">\(s.t.\)</span> <span class="math display">\[H(\lambda)=-\Sigma_{i=1}^{n}u_i+\Sigma_{i=1}^{n}\frac{-(u_i-v_i)e^{\lambda(u_i-v_i)}}{1-e^{\lambda(u_i-v_i)}}=0\]</span>
we get the mle <span class="math inline">\(\lambda^*\)</span> <span class="math display">\[H(\lambda)=\frac{d}{d\lambda}l(\lambda)=-\Sigma_{i=1}^{n}u_i+\Sigma_{i=1}^{n}\frac{-(u_i-v_i)e^{\lambda(u_i-v_i)}}{1-e^{\lambda(u_i-v_i)}}\]</span></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co">#mle generates the numerical solution</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="co">#compute log likelihood function root</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>obj.lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(left,right,lambda){</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(left)){</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k <span class="sc">+</span> (left[i] <span class="sc">-</span> right[i])<span class="sc">*</span><span class="fu">exp</span>(lambda<span class="sc">*</span>(left[i] <span class="sc">-</span> right[i]))<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(lambda<span class="sc">*</span>(left[i] <span class="sc">-</span> right[i])))</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>  }</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>  <span class="fu">sum</span>(left) <span class="sc">+</span> k</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>}</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>left <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">8</span>,<span class="dv">27</span>,<span class="dv">13</span>,<span class="dv">16</span>,<span class="dv">0</span>,<span class="dv">23</span>,<span class="dv">10</span>,<span class="dv">24</span>,<span class="dv">2</span>)</span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>right <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">9</span>,<span class="dv">28</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">1</span>,<span class="dv">24</span>,<span class="dv">11</span>,<span class="dv">25</span>,<span class="dv">3</span>)</span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(obj.lambda,<span class="at">lower =</span> <span class="fl">0.001</span>,<span class="at">upper =</span> <span class="fl">10e5</span>,<span class="at">left =</span> left,<span class="at">right =</span> right)</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>result <span class="ot">&lt;-</span> u<span class="sc">$</span>root</span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>result</span></code></pre></div>
<p>(2)EM observed <a href="data:$u_i" class="uri">data:$u_i</a>  v_i
,i=1,,n$ complete <a href="data:$u_i" class="uri">data:$u_i</a>  v_i
 s_i,i=1,,n<span class="math inline">\(,\)</span>s_i$ is the real value.
observed likelihood function is <span class="math display">\[L_o(p)=\prod_{i=1}^n(e^{-\lambda u_i}-e^{-\lambda
v_i})\]</span> <span class="math display">\[L(\lambda |
u,s,v)=  \lambda^n\prod_{i=1}^{n}e^{-\lambda s_i} \]</span> E-step When
the <span class="math inline">\(s_i\)</span> is unknown,<span class="math inline">\(f_{s|u,v}(s|u,v)=\frac{\lambda e^{-\lambda
s}}{e^{-\lambda u_i}-e^{\lambda v_i}}\)</span> <span class="math display">\[\begin{aligned}
\hat{s_i}&amp;=E(s_i|u,v) \\
&amp;=\frac{1}{\lambda}+\frac{u_ie^{-\lambda u_i}-v_ie^{\lambda
v_i}}{e^{-\lambda u_i}-e^{\lambda v_i}}
\end{aligned}\]</span></p>
<p><span class="math display">\[\begin{aligned}
Q(\lambda)&amp;=E[logL(s|u,v,\hat{\lambda})] \\
&amp;=nlog{\lambda}-\lambda \Sigma_{i=1}^{n}E(s_i|u,v,\hat{\lambda}) \\
&amp;=nlog{\lambda}-\lambda
\Sigma_{i=1}^{n}[\frac{1}{\hat{\lambda}}+\frac{u_ie^{{-\hat{\lambda}}
u_i}-v_ie^{{-\hat{\lambda}} v_i}}{e^{-{\hat{\lambda}}
u_i}-e^{-{\hat{\lambda}} v_i}}]
\end{aligned}\]</span></p>
<p>M-step <span class="math inline">\(\frac{d}{d\lambda}Q(\lambda)=\frac{n}{\lambda}-\Sigma_{i=1}^{n}[\frac{1}{\hat{\lambda}}+\frac{u_ie^{{-\hat{\lambda}}
u_i}-v_ie^{{-\hat{\lambda}} v_i}}{e^{-{\hat{\lambda}}
u_i}-e^{-{\hat{\lambda}} v_i}}]=0\)</span> <span class="math inline">\(\lambda_1 = \frac{n}{\Sigma_{i=1}^{n}
[\frac{1}{\hat{\lambda}}+\frac{u_ie^{{-\hat{\lambda}}
u_i}-v_ie^{{-\hat{\lambda}} v_i}}{e^{-{\hat{\lambda}}
u_i}-e^{-{\hat{\lambda}} v_i}}]}\)</span> We can see that <span class="math display">\[\lambda_{j+1} = \frac{n}{\Sigma_{i=1}^{n}
[\frac{1}{\lambda_{j}}+\frac{u_ie^{-\lambda_{j} u_i}-v_ie^{-\lambda_{j}
v_i}}{e^{-\lambda_{j} u_i}-e^{-\lambda_{j} v_i}}]}\]</span> According
the equation above,we assume that <span class="math inline">\(\lambda_{j+1}=\lambda_{j}\)</span>, <span class="math inline">\(\Sigma_{i=1}^{n}
\frac{\lambda_{j}u_ie^{-\lambda_{j} u_i}-\lambda_{i}v_ie^{-\lambda_{j}
v_i}}{e^{-\lambda_{i} u_i}-e^{-\lambda_{i} v_i}}=\Sigma_{i=1}^{n}
\frac{\lambda_{j}u_i-\lambda_{i}v_ie^{\lambda_{j}
(u_i-v_i)}}{1-e^{\lambda_{i} (u_i-v_i)}}=\Sigma_{i=1}^{n} [\lambda_j v_i
+\frac{\lambda_{j} u_i-\lambda_{j} v_i}{1-e^{\lambda_{i}
(u_i-v_i)}}]=0\)</span>, Take the equation into <span class="math inline">\(H(\lambda)=-\Sigma_{i=1}^{n}u_i+\Sigma_{i=1}^{n}\frac{-(u_i-v_i)e^{\lambda(u_i-v_i)}}{1-e^{\lambda(u_i-v_i)}}\)</span>,then,<span class="math inline">\(H(\lambda)=\Sigma_{i=1}^{n} [-v_i + \frac{v_i -
u_i}{1-e^{\lambda(u_i-v_i)}}]=0\)</span> Let <span class="math display">\[f(\lambda) = \frac{n}{\Sigma_{i=1}^{n}
[\frac{1}{\lambda}+\frac{u_ie^{-\lambda u_i}-v_ie^{-\lambda
v_i}}{e^{-\lambda u_i}-e^{-\lambda v_i}}]}\]</span>, <span class="math display">\[f&#39;(\lambda)=\frac{n\{\Sigma_{i=1}^{n}
[-\frac{1}{\lambda^2}+\frac{(u_i-v_i)^2e^{\lambda(u_i-v_i)}}{1-e^{\lambda(u_i-v_i)}}]\}}{[\Sigma_{i=1}^{n}
[\frac{1}{\lambda}+\frac{u_ie^{-\lambda u_i}-v_ie^{-\lambda
v_i}}{e^{-\lambda u_i}-e^{-\lambda v_i}}]]^2}\]</span> Take <span class="math inline">\(H(\lambda)=\Sigma_{i=1}^{n} [-v_i + \frac{v_i -
u_i}{1-e^{\lambda(u_i-v_i)}}]=0\)</span> and <span class="math inline">\(\lambda = \frac{n}{\Sigma_{i=1}^{n}
[\frac{1}{\lambda}+\frac{u_ie^{-\lambda u_i}-v_ie^{-\lambda
v_i}}{e^{-\lambda u_i}-e^{-\lambda v_i}}]}\)</span> into the equation of
<span class="math inline">\(f&#39;(\lambda)\)</span>,we have <span class="math inline">\(f&#39;(\lambda)=0\)</span> In summary, the
convergence of EM algorithm to MLE results and has the linear
convergence rate.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co">#number of iterations</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co">#set initial lambda </span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>ilow <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">8</span>,<span class="dv">27</span>,<span class="dv">13</span>,<span class="dv">16</span>,<span class="dv">0</span>,<span class="dv">23</span>,<span class="dv">10</span>,<span class="dv">24</span>,<span class="dv">2</span>)</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>iupper <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">9</span>,<span class="dv">28</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">1</span>,<span class="dv">24</span>,<span class="dv">11</span>,<span class="dv">25</span>,<span class="dv">3</span>)</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ilow)){</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>    m <span class="ot">&lt;-</span> ilow[j]<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>L<span class="sc">*</span>ilow[j])<span class="sc">-</span>iupper[j]<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>L<span class="sc">*</span>iupper[j])</span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a>    o <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>L<span class="sc">*</span>ilow[j])<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>L<span class="sc">*</span>iupper[j])</span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k <span class="sc">+</span> m<span class="sc">/</span>o <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>L</span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a>  }</span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fu">length</span>(ilow)<span class="sc">/</span>k</span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a>}</span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a>L</span></code></pre></div>
<p>We can see that the results of MLE and EM is almostly similar.</p>
</div>
<div id="question-11.8" class="section level2">
<h2>Question 11.8</h2>
<p>Consider the solution of game B=A+2 in Morra game and verify if it is
the extreme point in the original game A, calculate the values of game A
and game B</p>
</div>
<div id="answer-29" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>solve.game <span class="ot">&lt;-</span> <span class="cf">function</span>(A) {</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="co">#let elements in A are positive</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>smallA <span class="ot">&lt;-</span> <span class="fu">min</span>(A)</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>A <span class="ot">&lt;-</span> A <span class="sc">-</span> smallA </span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>largeA <span class="ot">&lt;-</span> <span class="fu">max</span>(A)</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>A <span class="ot">&lt;-</span> A <span class="sc">/</span> <span class="fu">max</span>(A)</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">nrow</span>(A)</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(A)</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>it <span class="ot">&lt;-</span> n<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a><span class="co">#set the objective function</span></span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, m), <span class="dv">1</span>) </span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">cbind</span>(<span class="fu">t</span>(A), <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, n)) </span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>A3 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, m), <span class="dv">0</span>)))</span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="at">a=</span>a, <span class="at">A1=</span>A1, <span class="at">b1=</span>b1, <span class="at">A3=</span>A3, <span class="at">b3=</span>b3,</span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a><span class="at">maxi=</span><span class="cn">TRUE</span>, <span class="at">n.iter=</span>it)</span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, n), <span class="dv">1</span>) </span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(A, <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, m)) </span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, m)</span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a>A3 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), <span class="dv">0</span>)))</span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a>sy <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="at">a=</span>a, <span class="at">A1=</span>A1, <span class="at">b1=</span>b1, <span class="at">A3=</span>A3, <span class="at">b3=</span>b3,</span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a><span class="at">maxi=</span><span class="cn">FALSE</span>, <span class="at">n.iter=</span>it)</span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a>soln <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> A <span class="sc">*</span> largeA <span class="sc">+</span> smallA,</span>
<span id="cb37-27"><a href="#cb37-27" tabindex="-1"></a><span class="st">&quot;x&quot;</span> <span class="ot">=</span> sx<span class="sc">$</span>soln[<span class="dv">1</span><span class="sc">:</span>m],</span>
<span id="cb37-28"><a href="#cb37-28" tabindex="-1"></a><span class="st">&quot;y&quot;</span> <span class="ot">=</span> sy<span class="sc">$</span>soln[<span class="dv">1</span><span class="sc">:</span>n],</span>
<span id="cb37-29"><a href="#cb37-29" tabindex="-1"></a><span class="st">&quot;v&quot;</span> <span class="ot">=</span> sx<span class="sc">$</span>soln[m<span class="sc">+</span><span class="dv">1</span>] <span class="sc">*</span> largeA <span class="sc">+</span> smallA)</span>
<span id="cb37-30"><a href="#cb37-30" tabindex="-1"></a>soln</span>
<span id="cb37-31"><a href="#cb37-31" tabindex="-1"></a>}</span>
<span id="cb37-32"><a href="#cb37-32" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>( <span class="dv">0</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb37-33"><a href="#cb37-33" tabindex="-1"></a><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb37-34"><a href="#cb37-34" tabindex="-1"></a><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>,</span>
<span id="cb37-35"><a href="#cb37-35" tabindex="-1"></a><span class="sc">-</span><span class="dv">3</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,</span>
<span id="cb37-36"><a href="#cb37-36" tabindex="-1"></a><span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,</span>
<span id="cb37-37"><a href="#cb37-37" tabindex="-1"></a><span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">5</span>,</span>
<span id="cb37-38"><a href="#cb37-38" tabindex="-1"></a><span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">6</span>,</span>
<span id="cb37-39"><a href="#cb37-39" tabindex="-1"></a><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">6</span>,</span>
<span id="cb37-40"><a href="#cb37-40" tabindex="-1"></a><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="sc">-</span><span class="dv">6</span>,<span class="sc">-</span><span class="dv">6</span>,<span class="dv">0</span>), <span class="dv">9</span>, <span class="dv">9</span>)</span>
<span id="cb37-41"><a href="#cb37-41" tabindex="-1"></a><span class="fu">library</span>(boot) </span>
<span id="cb37-42"><a href="#cb37-42" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">solve.game</span>(A)</span>
<span id="cb37-43"><a href="#cb37-43" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">solve.game</span>(A <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb37-44"><a href="#cb37-44" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(s2<span class="sc">$</span>x, s2<span class="sc">$</span>y), <span class="dv">7</span>)</span>
<span id="cb37-45"><a href="#cb37-45" tabindex="-1"></a>A.va1 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(s1<span class="sc">$</span>x,<span class="dv">9</span>,<span class="dv">1</span>))<span class="sc">%*%</span> A</span>
<span id="cb37-46"><a href="#cb37-46" tabindex="-1"></a>ava1 <span class="ot">&lt;-</span> A.va1 <span class="sc">%*%</span> <span class="fu">matrix</span>(s1<span class="sc">$</span>y,<span class="dv">9</span>,<span class="dv">1</span>)</span>
<span id="cb37-47"><a href="#cb37-47" tabindex="-1"></a>A.va2 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(s2<span class="sc">$</span>x,<span class="dv">9</span>,<span class="dv">1</span>))<span class="sc">%*%</span> (A<span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb37-48"><a href="#cb37-48" tabindex="-1"></a>ava2 <span class="ot">&lt;-</span> A.va2 <span class="sc">%*%</span> <span class="fu">matrix</span>(s2<span class="sc">$</span>y,<span class="dv">9</span>,<span class="dv">1</span>)</span>
<span id="cb37-49"><a href="#cb37-49" tabindex="-1"></a>ava1</span>
<span id="cb37-50"><a href="#cb37-50" tabindex="-1"></a>ava2</span></code></pre></div>
<p>Notice that the solutions obtained by the simplex method in this
example correspond to the extreme point (11.15).The difference between
game A and game B values is only about 2,it exactly matches B &lt;- A +
2.</p>
</div>
<div id="question-2.1.3" class="section level2">
<h2>Question 2.1.3</h2>
<p>Why use <span class="math inline">\(unlist()\)</span> to convert a
list to an atomic vector rather than <span class="math inline">\(as.vector()\)</span>?</p>
</div>
<div id="answer-30" class="section level2">
<h2>Answer</h2>
<p>Because when the elements of a list have different types, <span class="math inline">\(unlist()\)</span> uses the same coercion rules as
<span class="math inline">\(c()\)</span>.<span class="math inline">\(as.vector()\)</span> makes every element to be a
list. For example,</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>,<span class="st">&quot;we&quot;</span>)</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">unlist</span>(x)</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(x)</span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="fu">typeof</span>(y[<span class="dv">1</span>]),<span class="fu">typeof</span>(y[<span class="dv">2</span>])))</span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="fu">typeof</span>(z[<span class="dv">1</span>]),<span class="fu">typeof</span>(z[<span class="dv">2</span>])))</span></code></pre></div>
</div>
<div id="question-2.3.1" class="section level2">
<h2>Question 2.3.1</h2>
<p>(1)What does <span class="math inline">\(dim()\)</span> return when
applied to a vector? (2)If <span class="math inline">\(is.matrix(x)\)</span> is TRUE, what will <span class="math inline">\(is.array(x)\)</span> return?</p>
</div>
<div id="answer-31" class="section level2">
<h2>Answer</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="fu">dim</span>(x)</span></code></pre></div>
<p>We can see that the result is NULL.</p>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="fu">is.matrix</span>(x)</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="fu">is.array</span>(x)</span></code></pre></div>
<p>We can see that the result is also TRUE.</p>
</div>
<div id="question-2.4.5" class="section level2">
<h2>Question 2.4.5</h2>
<p>(1)What does <span class="math inline">\(as.matrix()\)</span> do when
applied to a data frame with columns of different types? (2)Can you have
a data frame with 0 rows? What about 0 columns?</p>
</div>
<div id="answer-32" class="section level2">
<h2>Answer</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>cy <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;ah&quot;</span>)</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="at">y=</span><span class="fu">I</span>(cy))</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a><span class="fu">str</span>(df)</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df)</span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>k</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a><span class="fu">typeof</span>(k[<span class="dv">2</span>,<span class="dv">2</span>])</span></code></pre></div>
<p>Each element of the matrix corresponds to each element of the data
frame and remains of the original type. (2)</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="dv">1</span>,<span class="at">y=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>d0 <span class="ot">&lt;-</span> df[<span class="cn">FALSE</span>,]</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> df[,<span class="cn">FALSE</span>]</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>d0</span></code></pre></div>
<p>We can see that there exists a data frame with 0 rows or 0
columns.</p>
</div>
<div id="question-exercises2" class="section level2">
<h2>Question exercises2</h2>
<p>The function below scales a vector so it falls in the range <span class="math inline">\([0,1]\)</span>.Apply it to every column of a data
frame and apply it to every numeric column in a data frame.</p>
</div>
<div id="answer-33" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>rng <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>(x <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>])</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>}</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">1.3</span>,<span class="fl">1.5</span>,<span class="fl">1.6</span>,<span class="dv">2</span>),<span class="at">y=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>,<span class="at">z=</span><span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>))</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>l1 <span class="ot">&lt;-</span> <span class="fu">length</span>(df1[<span class="dv">1</span>,])</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a>l2 <span class="ot">&lt;-</span> <span class="fu">length</span>(df1[,<span class="dv">1</span>])</span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,l2,l1)</span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a><span class="co">#Apply it to every column of a data frame</span></span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>l1){</span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>  cla <span class="ot">&lt;-</span> df1[<span class="dv">1</span>,i]</span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(cla)<span class="sc">==</span><span class="st">&quot;FALSE&quot;</span>){</span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a>      res1[,i] <span class="ot">&lt;-</span> <span class="fu">scale01</span>(df1[,i])</span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>  }</span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a>}</span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a>res1</span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,l2,l1)</span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a><span class="co">#apply it to every numeric column in a data frame</span></span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>l1){</span>
<span id="cb43-20"><a href="#cb43-20" tabindex="-1"></a>  cla <span class="ot">&lt;-</span> df1[<span class="dv">1</span>,j]</span>
<span id="cb43-21"><a href="#cb43-21" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(cla)<span class="sc">==</span><span class="st">&quot;TRUE&quot;</span>){</span>
<span id="cb43-22"><a href="#cb43-22" tabindex="-1"></a>      res2[,j] <span class="ot">&lt;-</span> <span class="fu">scale01</span>(df1[,j])</span>
<span id="cb43-23"><a href="#cb43-23" tabindex="-1"></a>  }</span>
<span id="cb43-24"><a href="#cb43-24" tabindex="-1"></a>}</span>
<span id="cb43-25"><a href="#cb43-25" tabindex="-1"></a>res2</span></code></pre></div>
</div>
<div id="question-exercises1" class="section level2">
<h2>Question exercises1</h2>
<p>Use <span class="math inline">\(vapply()\)</span> to: a) Compute the
standard deviation of every column in a numeric data frame. b) Compute
the standard deviation of every numeric column in a mixed data
frame.</p>
</div>
<div id="answer-34" class="section level2">
<h2>Answer</h2>
<ol style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="at">y=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">8</span>))</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>sd1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>  funs <span class="ot">&lt;-</span> <span class="fu">c</span>(sd)</span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>  <span class="fu">sapply</span>(funs, <span class="cf">function</span>(f) <span class="fu">f</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>}</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a><span class="fu">vapply</span>(df,sd1,<span class="at">FUN.VALUE=</span><span class="fu">c</span>(<span class="at">sd=</span><span class="dv">0</span>))</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="at">y=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">8</span>),<span class="at">z=</span><span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;d&quot;</span>,<span class="st">&quot;e&quot;</span>,<span class="st">&quot;f&quot;</span>))</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>sd1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  funs <span class="ot">&lt;-</span> <span class="fu">c</span>(sd)</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>  <span class="fu">sapply</span>(funs, <span class="cf">function</span>(f) <span class="fu">f</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>}</span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a><span class="fu">vapply</span>(df,sd1,<span class="at">FUN.VALUE=</span><span class="fu">c</span>(<span class="at">sd=</span><span class="dv">0</span>))</span></code></pre></div>
</div>
<div id="question-ex9.8" class="section level2">
<h2>Question ex9.8</h2>
<p>Consider the bivariate density<span class="math display">\[f(x,y)\propto\binom{n}{x}y^{x+a-1}(1-y)^{n-x+b-1},x=0,1,\ldots,n,0\leq
y\leq 1.\]</span> Use the Gibbs sampler to generate a chain with target
joint density <span class="math inline">\(f(x, y)\)</span> and use Rcpp
function.Compare the computation time of the two functions with the
function “microbenchmark”.</p>
</div>
<div id="answer-35" class="section level2">
<h2>Answer</h2>
<p>1)R function</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="co">#set initial value</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>gr <span class="ot">&lt;-</span><span class="cf">function</span>(N,M){</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,M,<span class="dv">2</span>)</span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a>x1 <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a>x2<span class="ot">&lt;-</span><span class="fl">0.1</span></span>
<span id="cb46-9"><a href="#cb46-9" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb46-10"><a href="#cb46-10" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb46-11"><a href="#cb46-11" tabindex="-1"></a>    x1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,n,x2)</span>
<span id="cb46-12"><a href="#cb46-12" tabindex="-1"></a>    x2 <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>,x1<span class="sc">+</span>a,n<span class="sc">-</span>x1<span class="sc">+</span>b)</span>
<span id="cb46-13"><a href="#cb46-13" tabindex="-1"></a>  }</span>
<span id="cb46-14"><a href="#cb46-14" tabindex="-1"></a>  x[j,<span class="dv">1</span>] <span class="ot">&lt;-</span> x1</span>
<span id="cb46-15"><a href="#cb46-15" tabindex="-1"></a>  x[j,<span class="dv">2</span>] <span class="ot">&lt;-</span> x2</span>
<span id="cb46-16"><a href="#cb46-16" tabindex="-1"></a>}</span>
<span id="cb46-17"><a href="#cb46-17" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb46-18"><a href="#cb46-18" tabindex="-1"></a>}</span></code></pre></div>
<p>2)Rcpp function</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="co">#include &lt;Rcpp.h&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>using namespace Rcpp;</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> [[Rcpp<span class="sc">::</span>export]]</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>NumericMatrix <span class="fu">gibbsC</span>(int N, int M) {</span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>  NumericMatrix <span class="fu">mat</span>(N, <span class="dv">2</span>);</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>  double x <span class="ot">=</span> <span class="dv">1</span>, y <span class="ot">=</span> <span class="fl">0.1</span>;</span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a>  <span class="cf">for</span>(int <span class="at">i =</span> <span class="dv">0</span>; i <span class="sc">&lt;</span> M; i<span class="sc">++</span>) {</span>
<span id="cb47-8"><a href="#cb47-8" tabindex="-1"></a>    <span class="cf">for</span>(int <span class="at">j =</span> <span class="dv">0</span>; j <span class="sc">&lt;</span> N; j<span class="sc">++</span>) {</span>
<span id="cb47-9"><a href="#cb47-9" tabindex="-1"></a>      x <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">5</span>, y)[<span class="dv">0</span>];</span>
<span id="cb47-10"><a href="#cb47-10" tabindex="-1"></a>      y <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>,x<span class="sc">+</span><span class="dv">2</span>, <span class="dv">8</span><span class="sc">-</span>x)[<span class="dv">0</span>];</span>
<span id="cb47-11"><a href="#cb47-11" tabindex="-1"></a>    }</span>
<span id="cb47-12"><a href="#cb47-12" tabindex="-1"></a>    <span class="fu">mat</span>(i, <span class="dv">0</span>) <span class="ot">=</span> x;</span>
<span id="cb47-13"><a href="#cb47-13" tabindex="-1"></a>    <span class="fu">mat</span>(i, <span class="dv">1</span>) <span class="ot">=</span> y;</span>
<span id="cb47-14"><a href="#cb47-14" tabindex="-1"></a>  }</span>
<span id="cb47-15"><a href="#cb47-15" tabindex="-1"></a>  <span class="fu">return</span>(mat);</span>
<span id="cb47-16"><a href="#cb47-16" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>g_cpp <span class="ot">&lt;-</span> <span class="st">&quot;../work/&quot;</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a><span class="fu">sourceCpp</span>(<span class="fu">paste0</span>(g_cpp,<span class="st">&quot;gibbs.cpp&quot;</span>))</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="at">gr=</span><span class="fu">gr</span>(N,M),<span class="at">cppgr=</span><span class="fu">gibbsC</span>(N,M))</span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a><span class="fu">summary</span>(ts)[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>)]</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
